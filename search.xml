<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>如何用ABBYY和Acrobat 给图书扫描版pdf添加书签和目录跳转</title>
      <link href="/posts/34aeefad.html"/>
      <url>/posts/34aeefad.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>摘要：从网上找的书籍资源，很多都是非官方的扫描版，不仅文件大，而且不能选中文字、没有书签目录，阅读体验很不好，介绍下如何用ABBYY和Acrobat 给图书扫描版pdf添加书签和目录跳转</p></blockquote><h2 id="abbyy-ocr识别扫描版pdf"><a class="markdownIt-Anchor" href="#abbyy-ocr识别扫描版pdf"></a> ABBYY OCR识别扫描版pdf</h2><p>点击【识别文档】</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282304858.png"></div></div>​</p><p>设置OCR语言，点击识别</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282313720.png"></div></div>​</p><h2 id="acrobat-添加书签和目录跳转"><a class="markdownIt-Anchor" href="#acrobat-添加书签和目录跳转"></a> Acrobat 添加书签和目录跳转</h2><h3 id="添加书签"><a class="markdownIt-Anchor" href="#添加书签"></a> 添加书签</h3><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282314966.png"></div></div>​</p><p>给书签分层级</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282320715.png"></div></div>​</p><h3 id="目录跳转"><a class="markdownIt-Anchor" href="#目录跳转"></a> 目录跳转</h3><p>选中文件，右键创建链接</p><p>​​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282321229.png"></div></div>​​</p><p>设置【链接类型】为不可见矩形，【链接动作】为跳至页面视图</p><p>‍</p><p>​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282320705.png"></div></div></p><p>根据之前设置的书签或者直接输入页码跳转，快速跳转到对应页面，然后点击【设置链接】，完成设置链接后，又回返回原来位置。</p><p>​​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308282323267.png"></div></div>​​​</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 软件使用 </tag>
            
            <tag> 生活技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于等待力和秩序感的思考</title>
      <link href="//post/thinking-about-waiting-power-and-order-f3swz.html"/>
      <url>//post/thinking-about-waiting-power-and-order-f3swz.html</url>
      
        <content type="html"><![CDATA[<h2 id="等待力"><a class="markdownIt-Anchor" href="#等待力"></a> 等待力</h2><p>所谓的「<strong>等待力</strong>」，我将其定义为有多少耐心去等待自己期待未来会发生的事情。</p><p>举例来说：我发动态，会期待得到别人的评论；网上购物了一件东西，会期待早日能收到；学习弹奏一首歌，会期待早日学完；追一部剧，会期待之后的剧情。</p><p><strong>我很缺乏等待力</strong>。</p><p>发完动态就会忍不住时不时的去打开手机刷新社交媒体，看有没有收到消息，而不是先把自己当下要做的事情先做好，等待消息主动来找我，所以每次发动态都很内耗，干事效率很低；</p><p>想买东西，总是一想买，就控制不住的冲动下单了，而不是了解清楚自己的需求，蹲到合适的价格，等待自己真正需要这个东西的时候才购买，所以买的东西常常积灰；</p><p>尤克里里练习指弹，总想着早日学完发视频炫耀，而不是每周固定几天，就练习这个曲子，等待通过自己一点点练习，真正掌握这首曲子，把指法和节奏连熟练，不再依靠别人的视频可以独立弹好。</p><p>追剧读小说，常常一追就通宵，囫囵吞枣，看是看爽了，看完啥也记不住，而不是每天每周读一章看一集，让其融入自己的生活习惯中，这样不仅剧情的记忆更深，也对剧情有自己的思考。</p><p>如果人类就是不擅长等待的，那我觉得我们应该学会培养耐心，提高等待力。有等待力的人，可能可以收获更强的幸福感、更好的解决问题能力、更少的健康问题。我希望，自己也能成为一个等待力高的人。</p><p>接下来，我希望自己能做到：</p><ul><li>循序渐进并且持之以恒的学习一项技能，使之成为自己的特长和兴趣爱好，并通过爱好扩大社交圈子，了解自己到底想成为什么样的人；</li><li>做一件事能够有耐心的做，遇到问题能冷静的思考，不急不躁，按自己的节奏处理事务；</li><li>能够有规划的去做一些个人长期项目，比如旅游摄影方面就是逛完上海的所有免费公园，编程方面就是学习深度学习，能够运用代码去解决问题，专业课方面就是学习基础入门书，了解专业发展史。</li></ul><hr><h2 id="秩序感"><a class="markdownIt-Anchor" href="#秩序感"></a> 秩序感</h2><p>所谓的「<strong>秩序感</strong>」，我定义为，你能掌控自己生活的程度。</p><p>生活需要秩序感，如果能做到，什么东西要放在什么地方，什么时候要做什么事情，什么时候睡觉什么时候起床。这样，总能很容易找到要找的东西，总能知道当下应该做些什么而不感到无聊，总能有一个好的精神去迎接下一天。</p><p>建立秩序感很重要，当你处在混乱状态时，很容易一点点消磨自己的能量，不足以支撑你去做一些特别大的事情，如果能够尝试开始建立自己的生活秩序，开始把作息往正常轨道拉，每实现一次，能量就感觉回复一点，长此以往，积攒的能量会促使你完成更大的挑战，各方面开始稳中向好，能够开始掌控生活的船舵使之朝向你想要的方向。</p><p>建立秩序感是一个制造确定性的过程，确定的作息、确定的运动、确定的待办事项，这都会让你对自身和生活的掌控感越来越强，这就是一个从不确定到确定，从混乱到有序的过程。而建立秩序感的第一步，应该先从身体健康开始，把生活处理好，才能够从中积攒到能量去做更困难的事情。</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 阿巛随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人反思 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一只23岁母单的反思</title>
      <link href="//post/a-mother-s-reflection-z17orfm.html"/>
      <url>//post/a-mother-s-reflection-z17orfm.html</url>
      
        <content type="html"><![CDATA[<p>其实高中，大学，研究生都有动心的女生，不过因为种种问题都是止于暧昧。这里就简单分析下自己的问题和执念，就不讲对方的问题了。</p><p>高中主要因为要去不同的大学，注定异地，就不上心了。这一阶段的执念是不接受异地。这一阶段，由于高中压力比较大，非常的自卑和抑郁，人很不开朗，只会期待别人能关心自己。大学通过阅读心理方面的书籍和参加各种活动，慢慢变得开朗和自信独立起来了，但还是不够。</p><p>大学喜欢的女生，因为我主动找她总是爱搭不理，我不找她，她又来主动找我，两个人都是内向的人，导致非常内耗，会在觉得她喜欢我和不喜欢我之间来回跳跃，好感被慢慢消磨掉，觉得对方只是把我当工具人，需要的时候找我帮忙，不需要就爱搭不理。这一阶段的执念是想要和喜欢的女生说早晚安。这一阶段虽然变开朗了，但自己有一个毛病，一觉得对方不喜欢自己就不想搭理人，完全把对方当成透明，想着你不喜欢我我就不主动打扰你好了，目前在学习改掉这点，真的很有问题。</p><p>研究生阶段的执念是想要约喜欢的女生出去，而对方一直以忙为理由拒绝，被拒绝了一次又一次，才终于醒悟，原来早就被发了好人卡而不自知。此外，太早对对方表白，对方的回复是“暂时不想谈恋爱，看以后有没有缘在一起”，导致自己陷于很被动的局面，也让两个人无法像普通异性朋友相处。</p><p>今后，可能更想和人交朋友，不过分期待爱情了。要在学习如何和人线下社交，自己是网络社牛，但是线下社交真的不行，因为平常都是自己一个人玩耍，热衷于读书、看电影、骑车、摄影逛公园、弹琴、陆冲这种只需要一个人就能玩的很开心的活动，如果要带上另外一个，就不太清楚怎么办了，因为自己很少花钱去消费，餐馆、电影院、游乐园还有那些需要花钱的运动场馆都很少接触。之前一直以来的想法是<strong>一个人能走得更快</strong>，但是最近的感慨是<strong>两个人能走得更远</strong>，还是不能闭门造车自娱自乐，要多认识不同的人，从不同的视角认识这个世界，最终更好的认识自我、提升自我。</p>]]></content>
      
      
      <categories>
          
          <category> 阿巛随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人反思 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我终于清空朋友圈啦！</title>
      <link href="//post/i-finally-empty-the-circle-of-friends-oko3o.html"/>
      <url>//post/i-finally-empty-the-circle-of-friends-oko3o.html</url>
      
        <content type="html"><![CDATA[<p>我终于清空朋友圈了！！！</p><p>一直都想要戒掉发朋友圈的习惯，有很多原因，比如发朋友圈图片会压缩，不能再编辑，限制字数，不能发gif等等，很限制。</p><p>比如自己是一个很敏感的人，又是一个分享欲很强的人，如果我看到我发的朋友圈某个好友没点赞，而ta给我前面和后面的人都点赞了，我就会很沮丧，觉得对方不喜欢我。每次发了一条动态，就会时不时看有没有人给我点赞评论，有的话我不觉得开心，但没有就很失落。</p><p>比如朋友圈共同好友点赞评论都有提示，我很烦。目前有屏蔽某个动态的消息也很麻烦。</p><p>比如朋友圈的消息几乎都只是点赞，很少人会对我的动态提出意见和建议，我觉得一个动态应该发在合适的圈子，尤克里里就发到尤克里里的圈子，摄影就发到摄影的圈子，所以我会更喜欢发在网络社交软件里。</p><p>比如因为很喜欢发朋友圈，很多事情我就默认好友已经看到了，就不会再主动讲过去一些开心的事情了，这样我觉得会有损我的口头表达能力</p><p>比如我有点过于依赖朋友圈社交了，爱发朋友圈的人我会主动夸人家拍的好看工作优秀等等，不发朋友圈的人我就找不到机会认识，见面了也不搭理人，网上社牛线下社恐。</p><p>综上，我觉得发朋友圈对我来说弊大于利。但是之前一直想戒掉都没戒成功，这次我希望通过删除全部动态的方式来强制戒掉。而且目前我的动态也几乎没人和我互动了，删了就删了，反正也没人看。不过删的过程我才发现自己真的很爱发，几天就一条，从2018年删掉今年，删到手疼。我去年其实就把qq空间给清空了，这样qq和微信就没半条动态了，再也不想这两个软件塑造什么形象人设，天真地希望别人通过我的动态认识我了。（话说断舍离方面我真的是一点都不心慈手软）</p><p>踏实做自己，不要在意别人的评价了。</p><p>当然了，不代表我不发动态了，我就是一个分享欲很强的人和喜欢写东西的人，不过我希望自己少发碎片化的生活记录，多写长长的随笔和博客，多思考多总结多沉淀，以后珍贵的回忆和随笔，都会优先写在在思源笔记里，再分享到网络里去</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308141024199.jpg"></div></div>​</p>]]></content>
      
      
      <categories>
          
          <category> 阿巛随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人反思 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>23岁啦</title>
      <link href="//post/23-years-old-zggy4y.html"/>
      <url>//post/23-years-old-zggy4y.html</url>
      
        <content type="html"><![CDATA[<p>算是最多朋友祝我生日快乐的一次生日了，虽然也就三个人。</p><p>研一也算结束了吧，也简单总结下研一一年的心态变化。</p><p>老实说，研究生比我想象的累多了，如果没有适当的时间管理，平衡好工作和生活，真的挺难熬下去的。事情又多，工资又少，真的就是廉价劳动力。</p><p>研一上，因为院的设计，需要进行三轮轮转，每个老师底下轮1.5个月，轮转结束要写一个小轮转报告。我当时就是太单纯了，每个轮转都做的非常认真，每个报告都以本科毕设论文形式去写，再加之研一上课程很多汇报很多，导致研一上非常非常累，1点半下班是常态。由于没有平衡好工作和生活，满脑子都是科研项目，一直都紧绷着，身心健康损坏特别大，掉了很多头发，一天不洗头都有油油，容易抓出白色的脂肪粒，到目前都还在用专门的洗发水调理。研一的寒假，我在家基本没怎么见亲朋好友，都在睡觉，缓了很久。</p><p>研一下，一方面是身体已经不支持我再像过去那样熬夜，一方面也是意识到这样的状态不可持久。人生是一次长跑，可别开头就冲刺用光了力气，要可持续发展地努力，渐进式地进步。于是，研一下，我开始尝试平衡工作和生活，开始在空闲时间发展自己的兴趣爱好，弹尤克里里，买相机学习摄影，买陆地冲浪板第一次接触板类运动。目前的状态也一点点回复，心态也比以前乐观开朗多了，自认为是一个好的转变。</p><p>当然，我还是得自我反思下目前的不足滴。</p><p>研一下花在课题的时间因为兴趣爱好而减少了，减少没问题，不要有休闲羞愧嘛。但是还是希望自己效率更高些，早工作完早下班，不要非要和人竞争下班时间多晚，总是磨磨蹭蹭，还是经常23点以后才下班，这点得改。</p><p>空闲时间，娱乐的时间多了，学习充电的时间却少了，本科时空闲时间会有目的学习各种技能，会读书，现在却是经常无目的刷着b站和小红书，白白消磨时间。我觉得玩手机不一定会让自己放松，科学的放松是主动做一些自己感兴趣的事情，对自己长久有益的事情就更好了，我还是觉得我空闲时间应该多花在编程技术的提高、学习神经网络以及阅读文献提升思辨力上。</p><p>还是太在意别人，太去追求别人的认同，经常是为了别人的肯定去发朋友圈，设计文案。发完之后会时不时看有没有人点赞，这个人点赞别人不点赞我，是不是不喜欢我，我做的不够好？不要去追求别人的认同了，否则永远得不到自己对自己的认同，要努力提升自己，提升价值感，让自己变得自信才行！</p><p>待人不够真诚。我网友很多，但是现实世界却没有几个能面对面交流的朋友，一部分原因是自己过去是留守儿童，就连和家人的关系都并不亲密，自己很难真正相信人，去付出真心，总是刻意和所有人保持一定距离。另一方面也是太过敏感，很容易觉得对方不喜欢自己而刻意远离，觉得受伤了并不会和对方交流，而是一声不吭的就离人远远的了。</p>]]></content>
      
      
      <categories>
          
          <category> 阿巛随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人反思 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Groupy多窗口管理工具</title>
      <link href="/posts/291034.html"/>
      <url>/posts/291034.html</url>
      
        <content type="html"><![CDATA[<p>官网：<a href="https://www.stardock.com/products/groupy/">Stardock Groupy: Tabs for Windows</a></p><h2 id="功能简介"><a class="markdownIt-Anchor" href="#功能简介"></a> 功能简介</h2><p>在使用软件的时候，我们常常会一口气打开很多窗口进行操作，但在使用时，杂乱无章的窗口会让工作效率大打折扣。</p><p>​​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252305052.gif"></div></div>​​​</p><p>与其分散使用各个软件，不如把它们的窗口整合到一起。Groupy 就是一款可以将所有软件窗口整合到一起的工具，用操作浏览器的方式来管理任意软件窗口。</p><h3 id="拖拽合并软件窗口"><a class="markdownIt-Anchor" href="#拖拽合并软件窗口"></a> 拖拽合并软件窗口</h3><p>没有复杂的软件界面，安装后软件窗口自动成为可扩充的标签页。将窗口拖拽到其他软件的标签栏时松手即可合并软件窗口。</p><p>​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252304833.gif"></div></div>​​</p><h3 id="便捷管理与分组"><a class="markdownIt-Anchor" href="#便捷管理与分组"></a> 便捷管理与分组</h3><p>多个软件一个窗口即可管理，快速在多个文档或文件夹中切换。将相关的软件整合到一起，分组操作软件，优化工作流程。还有自动分组功能，减少复杂操作，提高效率。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252305332.png"></div></div></p><p>​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252305740.gif"></div></div>​​​</p><h3 id="窗口内容快速预览"><a class="markdownIt-Anchor" href="#窗口内容快速预览"></a> 窗口内容快速预览</h3><p>支持速览功能，鼠标停留在软件窗口标签上，即可预览软件窗口中的内容</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252304937.gif"></div></div>​</p><h3 id="窗口快速添加保存现有分组"><a class="markdownIt-Anchor" href="#窗口快速添加保存现有分组"></a> 窗口快速添加，保存现有分组</h3><p>需要快速新建文档、打开其他文件夹?点击标签栏上的加号，一键快速添加新文档或资源窗口。而现在设置的窗口分组可以保存起来，今后可以快速打开操作所需的所有软件。</p><p>​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252304686.gif"></div></div>​​</p><h2 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h2><p>推荐设置为【仅在按下Ctrl时分组】：【设置】-【何时启用窗口分组】-【仅在按下Ctrl时分组】</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252304016.png"></div></div>​</p><p>自动分组：</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252304443.png"></div></div>​</p><p>是否始终显示此类窗口的标签页，取消勾选后，只有窗口合并之后才显示Groupy标签页</p><p>​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252304472.png"></div></div>​​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 工具 </tag>
            
            <tag> 软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>巨蟹座的独白</title>
      <link href="/posts/c873b400.html"/>
      <url>/posts/c873b400.html</url>
      
        <content type="html"><![CDATA[<p>作为资深老巨蟹，说句实话，巨蟹座男生挺难搞的，初次见面让人感觉很正经，很闷，不爱说话，不爱表现自己，基本不会主动，因为巨蟹就是个被动的星座，如果你主动找他讲话，他也会很认真的回答你，注意，真的是很认真，所以板正应该是巨蟹给人的第一印象，所以社交的话蟹蟹们还是有一定优势的，起码看着是个正经人吧。</p><p>但巨蟹真的正经吗？正经是正经，但闷骚也是真闷骚。我觉得巨蟹座的形象应该改成寄居蟹，不止层坚硬的壳，巨蟹就把自己藏在一层层的壳子里，等着别人走进他们的心里。熟人和朋友面前的巨蟹，什么都能说，什么都能侃，什么都能玩，没有约束，甚至于更疯，让你怀疑这还是我当初认识的那个巨蟹吗？而且巨蟹普遍都会替别人着想，而且喜欢依靠着自己信任的人，所以如果一个巨蟹愿意迁就你，遇到事情想跟你诉说，那恭喜你已经成为巨蟹心中的&quot;自家人&quot;了。他们也普遍善良，对待朋友两肋插刀，而且是嘴上不愿多说，但是行动的巨人。愿意倾听你，不会轻易打断你，喜欢和你分享快乐。</p><p>但巨蟹的敏感你可能要有心理准备，真的是别人可能无心的一句话，会深深刺伤巨蟹，迫使他把自己重新藏进壳里，所以当你发现巨蟹突然地不说话，不高兴写在脸上，回避你的交流，甚至不回答你的问题时，他就是被你的哪一句话或是某种行为伤了。真的太敏感了，而且细节观察能力惊人，尤其是对于人类间情绪的敏感度极高，所以巨蟹座是受情绪影响的星座。不止敏感，而且被动，自己藏着掖着，自己焦虑，自己烦恼，自己伤心，自我封闭，这就是最坏的巨蟹。所以希望你能稍微主动一点，让巨蟹知道你还在乎他，你不是真的要伤害他，他会一秒变地心情大好，情绪变化贼快，最最核心的，安全感，让巨蟹有安全感，不管是巨蟹男还是巨蟹女，都是第一位的。所以家人在巨蟹心中永远第一位，你愿意成为他们的家人吗？</p><p>​</p>]]></content>
      
      
      <categories>
          
          <category> 阿巛随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人反思 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阿巛对信息时代整理信息的经验浅谈</title>
      <link href="/posts/d766b22.html"/>
      <url>/posts/d766b22.html</url>
      
        <content type="html"><![CDATA[<h2 id="图片管理方式"><a class="markdownIt-Anchor" href="#图片管理方式"></a> <strong>图片管理方式</strong></h2><p>日常摄影图片定期上传在Onedrive的【dailylog】文件夹里（不想被手机厂商的云盘绑定），命名方式为日期+事件。课程、讲座图片放在手机的相册【讲座&amp;课程】。</p><p>有的时候由于插入笔记等需要，对图片进行批量压缩，使用的是utools的官方插件能对整个文件夹的图片进行压缩，大大减小图片的文件大小。</p><p>手机的修图软件，目前主要用的是醒图（滤镜、模板很多）、图叨叨（加相机水印），最近开始接触到lightroom，不过还不熟悉。</p><p>dailylog 文件夹截图</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309074.png"></div></div>​</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309292.png"></div></div>​</p><h2 id="word和ppt文件管理方式"><a class="markdownIt-Anchor" href="#word和ppt文件管理方式"></a> <strong>Word和PPT文件管理方式</strong></h2><p>目前的管理方式是认为Word和PPT放在一起很舒服，以前比如上一门课，遇见一件事，会专门创建一个文件夹，然后放PPT和Word，导致这些文件都很散乱，虽然要找是能找到的。目前的管理思路是，把这些文件都放在一起，文稿类的一个文件夹，汇报类的一个文件夹，如果实在有必要再专门创建一个事件文件夹，把对应的文件以超链接的形式丢进去，这样也方便利用之前的创作心血。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309259.png"></div></div>​</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309925.png"></div></div>​</p><p>对于PPT，我设计了用于个人汇报的模板，针对不同的场景设计了一些母版样式</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309835.png"></div></div>​</p><p>对于Word文稿写作，也有一个样式模板，习惯是用思源笔记写初稿导出md，然后用quarto（下一代RMarkdown）将md渲染为我设计的word模板样式。具体可见</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309803.png"></div></div>​</p><h2 id="手机电脑同步文件"><a class="markdownIt-Anchor" href="#手机电脑同步文件"></a> 手机电脑同步文件</h2><p>鉴于现在主力聊天软件用微信，考虑到微信的文件传输电脑没登陆就传输一般收不到，会在onedrive创建一个【临时文件夹】，专门用来同步临时的文件。</p><h2 id="待办管理方式"><a class="markdownIt-Anchor" href="#待办管理方式"></a> 待办管理方式</h2><p>目前主要的待办软件是滴答清单，主要看重它支持日历视图+番茄钟，并且还支持markdown笔记。</p><p>在待办清单分为上，主要分为【工作】【个人充电】【琐事】【收集箱】，其中【个人充电】这个模块我分类比较细，其他模块的使用还有待改进。【收集箱】这个参考了GTD的管理方式，琐事、一些想法、稍后细读的文章视频都会丢进去。（其实按理来说应该加标签进行分类的，但我总是懒得加）</p><p>目前还挖掘到滴答清单做临时笔记非常好用，特别是一些琐事的笔记，所以额外创建了一个【临时笔记】。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252310543.png"></div></div>​</p><p>手机的桌面的小组件主要放了两个分类，【收集箱】与【临时笔记】。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252310981.jpg"></div></div>​</p><h2 id="笔记管理方式"><a class="markdownIt-Anchor" href="#笔记管理方式"></a> 笔记管理方式</h2><p>目前主力笔记是思源笔记，一款本地优先的双链笔记软件。</p><p>我目前使用的笔记方式，叫做dailynote，或者叫渐进式笔记法。简单说就是每日主要在日记页面做笔记，利用双链传递信息这一特性，依靠每天不断积累、不断丰富所引用文档或块的信息浓度，也就是你可以新建一个空白文档，暂时可以啥都不写，每天有点小心得就双链引用下，写下当日心得，等觉得积累差不多了再整理信息成为自己的知识笔记。做一个比喻就是，种下很多颗种子，每日悉心照料，等待它开花结果，最终拥有独属自己的知识花园。</p><p>以Adobe Illustrator的笔记为例，展示双链笔记的渐进式笔记法特点</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252310780.png"></div></div>​</p><p>下面是我“日记”的模板</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252310547.png"></div></div>​</p><p>另外说下，目前创建笔记文档我也是用双链来创建，利用软件的配置方法，可以让这些文档自动放在当月文档下，无需考虑分类，减小记笔记的摩檫力</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252310343.png"></div></div>​</p><h2 id="网盘资源"><a class="markdownIt-Anchor" href="#网盘资源"></a> 网盘资源</h2><p>目前的主力网盘是阿里云盘（OneDrive只当同步盘，考虑速度不稳定及容量小），相比百度网盘来说，最大特点是非会员下载速度还可以，目前影视资源分享阿里云盘的也非常多。</p><p>主要会放把个人的信息文件（比如身份证、户口簿、银行卡、荣誉证书、证明文件等等）、资源（影视、书籍、课程资源、软件资源）以及归档（考证的笔记与资源、大项目的文件）。</p><p>目前阿里云盘并不支持分享常见的zip、rar等压缩包，我目前主要用bandzip制作exe格式的压缩包。</p><p>影视资源的寻找主要在酷安的阿里云盘软件评论区搜刮，很多影片一搜就有。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202304252309456.png"></div></div>​</p>]]></content>
      
      
      <categories>
          
          <category> 阿巛随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人反思 </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装mambaforge</title>
      <link href="/posts/c6467c9c.html"/>
      <url>/posts/c6467c9c.html</url>
      
        <content type="html"><![CDATA[<h2 id="为什么要用mambaforge"><a class="markdownIt-Anchor" href="#为什么要用mambaforge"></a> 为什么要用mambaforge？</h2><p>Anaconda 臃肿，</p><h2 id="下载"><a class="markdownIt-Anchor" href="#下载"></a> 下载</h2><p><a href="https://github.com/conda-forge/miniforge">conda-forge/miniforge: A conda-forge distribution. (github.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Windows-x86_64.exe</span><br></pre></td></tr></table></figure><h2 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h2><p>mamba init：<code>~/.bash_profile</code>​添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(&#x27;/c/Users/Achuan-2/mambaforge/Scripts/conda.exe&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;/c/Users/Achuan-2/mambaforge/etc/profile.d/mamba.sh&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    . <span class="string">&quot;/c/Users/Achuan-2/mambaforge/etc/profile.d/mamba.sh&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="新建个人环境"><a class="markdownIt-Anchor" href="#新建个人环境"></a> 新建个人环境</h2><p>新建个人环境，base环境不装东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n achuan --<span class="built_in">clone</span> base</span><br></pre></td></tr></table></figure><p>安装基础包：vim equirements.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">autopep8</span><br><span class="line">numpy</span><br><span class="line">pandas</span><br><span class="line">tqdm</span><br><span class="line">pandas</span><br><span class="line">matplotlib</span><br><span class="line">Pillow</span><br><span class="line">seaborn</span><br><span class="line">ipympl</span><br><span class="line">ipykernel</span><br><span class="line">scikit-image</span><br><span class="line">jupyterlab</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mamba install --<span class="built_in">yes</span> --file requirements.txt</span><br></pre></td></tr></table></figure><h2 id="配置镜像"><a class="markdownIt-Anchor" href="#配置镜像"></a> 配置镜像</h2><p>​<code>vim ~/.condarc</code>​</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">conda config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conda config --add channels bioconda</span><br><span class="line"><span class="comment">#conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/</span></span><br><span class="line"><span class="comment">#conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conda config --get channels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conda config --<span class="built_in">set</span> show_channel_urls <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复默认镜像</span></span><br><span class="line">conda config --remove-key channels</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="问题"><a class="markdownIt-Anchor" href="#问题"></a> 问题</h2><h3 id="windows-不支持mamba-init只能用conda-activate来切换环境"><a class="markdownIt-Anchor" href="#windows-不支持mamba-init只能用conda-activate来切换环境"></a> windows 不支持mamba init，只能用conda activate来切换环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;gbk&#x27;</span> codec can<span class="string">&#x27;t decode byte 0xaa in position 347: illegal multibyte sequence</span></span><br><span class="line"><span class="string">An unexpected error has occurred. Conda has prepared the above report</span></span><br></pre></td></tr></table></figure><ul><li><p>解决方法</p><p>C:\Users\Achuan-2\mambaforge\Lib\site-packages\mamba\mamba_shell_init.py</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- 35 with open(file, &quot;r&quot;) as fi:</span></span><br><span class="line"><span class="addition">+ 35 with open(file, &quot;r&quot;,encoding=&quot;utf-8&quot;) as fi:</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCode 配置 Matlab 运行环境</title>
      <link href="/posts/c873b400.html"/>
      <url>/posts/c873b400.html</url>
      
        <content type="html"><![CDATA[<h2 id="需要的扩展"><a class="markdownIt-Anchor" href="#需要的扩展"></a> 需要的扩展</h2><ul><li><a href="https://marketplace.visualstudio.com/items?itemName=Gimly81.matlab">Matlab </a>：支持代码高亮、snippets、代码检查</li><li><a href="https://marketplace.visualstudio.com/items?itemName=AffenWiesel.matlab-formatter">matlab-formatter</a>：设定缩进距离以及是否分隔块</li><li><a href="https://marketplace.visualstudio.com/items?itemName=apommel.matlab-interactive-terminal">Matlab Interactive Terminal - Visual Studio Marketplace</a>：调用了 matlab 官方提供的 python engine，无需打开 matlab 的 IDE 即可运行 matlab 终端</li></ul><h2 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h2><h3 id="为-python-配置-matlab-引擎的-api"><a class="markdownIt-Anchor" href="#为-python-配置-matlab-引擎的-api"></a> 为 Python 配置 Matlab 引擎的 API</h3><p>在管理员模式打开终端，运行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Program Files\MATLAB\R2022b\extern\engines\pythonn&quot;</span> python setup.py install</span><br></pre></td></tr></table></figure><blockquote><p>如果报错：​<code>error: [WinError 5] 拒绝访问。: 'dist\matlabengineforpython.egg-info'</code>​</p><p>说明没打开管理员模式。</p></blockquote><h3 id="vscode-的-settingsjson-配置"><a class="markdownIt-Anchor" href="#vscode-的-settingsjson-配置"></a> VSCode 的 Settings.json 配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ------matlab Start----------- //</span></span><br><span class="line"><span class="attr">&quot;files.associations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;*.m&quot;</span><span class="punctuation">:</span> <span class="string">&quot;matlab&quot;</span> <span class="comment">// 为.m文件启动 Matlab 扩展</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;matlab.linterEncoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;utf8&quot;</span><span class="punctuation">,</span>  <span class="comment">// 设置mlint返回结果编码为 utf8</span></span><br><span class="line"><span class="attr">&quot;matlab.matlabpath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\MATLAB\\R2022b\\bin\\matlab.exe&quot;</span><span class="punctuation">,</span> <span class="comment">// 根据自己的路径设置matlab.exe路径</span></span><br><span class="line"><span class="attr">&quot;matlab.mlintpath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\MATLAB\\R2022b\\bin\\win64\\mlint.exe&quot;</span><span class="punctuation">,</span> <span class="comment">// 根据自己的路径设置mlint.exe路径</span></span><br><span class="line"><span class="comment">// ------matlab End----------- //</span></span><br></pre></td></tr></table></figure><h2 id="如何使用"><a class="markdownIt-Anchor" href="#如何使用"></a> 如何使用</h2><p>打开 Matlab 终端：<code>Ctrl + Shift + P ​</code>​→ <code>Open a Matlab Terminal</code>​</p><p>运行当前打开的脚本：​<code>Ctrl + Shift + P ​</code>​→ <code>Run current Matlab Script</code>​</p><p>执行选中的部分代码：​<code>Ctrl + Shift + P ​</code>​→<code>Run current selection in Matlab</code>​</p><p>添加脚本到 Matlab 路径中，在 matlab 终端中输入 <code>pathtool</code>​，然后弹出如下窗口</p><p>​​<div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202308101027924.png"></div></div>​​</p><h2 id="不建议"><a class="markdownIt-Anchor" href="#不建议"></a> 不建议</h2><ul><li><p>使用 code runner 扩展跑 Matlab</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;code-runner.executorMap&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;matlab&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cd $dir &amp;&amp; matlab -nosplash -nodesktop -r $fileNameWithoutExt&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></li><li><p>使用 <a href="https://marketplace.visualstudio.com/items?itemName=bramvanbilsen.matlab-code-run">Matlab Code Run</a> 扩展</p></li></ul><h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/395486395">使用 vscode 编辑并运行 matlab 脚本 - 知乎 (zhihu.com)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VSCode </tag>
            
            <tag> Matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quarto：Markdown 又何必只是 Markdown</title>
      <link href="/posts/50f47788.html"/>
      <url>/posts/50f47788.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>Quarto 是下一代的 Rmarkdown，相比 Rmarkdown 来说，把生态给大一统了，你甚至不需要有 R 环境也能用，VSCode 上也有专门的<a href="https://marketplace.visualstudio.com/items?itemName=quarto.quarto">插件</a>。Quarto 的强大之处在于，不仅仅在于可以渲染代码运行结果，而且导出文档方面是我目前见过最无敌的存在，相信我，用上它，你会见到 markdown 的另一片天空。你只需要把 md 改成 qmd 后缀，加上一个 yaml 头，轻轻一点渲染按钮，就可以导出 word、html、ipynb、GFM 规范的 md（还可以设置公式导出为纯文本还是图片），甚至当成简易版的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 代码与 markdown 语法混用，导出样式精美的 pdf。</p></blockquote><p>关联文章：：<a href="https://www.achuan-2.top/posts/bc4b56d9.html">设置word模板，Markdown 也能自动转换为美观规范的 Word 文档</a></p><h2 id="为什么要用-quarto"><a class="markdownIt-Anchor" href="#为什么要用-quarto"></a> 为什么要用 Quarto？</h2><p>先简单介绍下 Quarto，官网地址 <a href="https://quarto.org/">https://quarto.org/</a>。</p><p>官网是这样介绍的：</p><blockquote><p>Quarto is an open-source scientific and technical publishing system built on <a href="https://pandoc.org/">Pandoc</a></p><ul><li>Create dynamic content with <a href="https://quarto.org/docs/computations/python.html">Python</a>, <a href="https://quarto.org/docs/computations/r.html">R</a>, <a href="https://quarto.org/docs/computations/julia.html">Julia</a>, and <a href="https://quarto.org/docs/computations/ojs.html">Observable</a>.</li><li>Author documents as plain text markdown or <a href="https://jupyter.org/">Jupyter</a> notebooks.</li><li>Publish high-quality articles, reports, presentations, websites, blogs, and books in HTML, PDF, MS Word, ePub, and more.</li><li>Author with scientific markdown, including equations, citations, crossrefs, figure panels, callouts, advanced layout, and more.</li></ul></blockquote><p>简单来说，Quarto 这个软件可以</p><ul><li><p>用来写代码：类似 Jupyter Notebook，可以 Markdown 和代码一起写，并能渲染代码结果到文档里，支持的语言有 Python、R、Julia 和 Observable，能将渲染结果输出为 HTML、PDF、Word 和 GFM Markdown。对于输出为 Markdown，公式还支持直接转换为 <a href="https://github.com/KTHse/webtex">WebTex</a> 图片，方便发布到其他博客或放入笔记软件里；</p></li><li><p>用来写严肃的报告：相当于pandoc加强版和LaTex简易版，支持导出为PDF、Word，并且支持交叉引用，可以引用图表、引用文献。</p></li><li><p>用来写博客、写书。</p><ul><li>写博客的文档：<a href="https://quarto.org/docs/websites/">Quarto - Creating a Website</a>；</li><li>写书的文档：<a href="https://quarto.org/docs/books/">Quarto - Creating a Book</a>。</li></ul></li></ul><p>Quarto 可以说是下一代 RMarkdown ，相比 RMarkdown，将环境给大统一，更好的适配 VSCode，你甚至不需要有 R 环境、安装 Rstudio，就能用 Quarto 写文章和报告。我对 Quarto 的整体印象，可以概括为“枢纽”二字，能写代码，能与 Jupyter Notebook 相互转换，能将 Markdown 导出为各种常用格式，可以当成简易版的 LaTex 写报告，将 Markdown 的生态大大强化。</p><p>而 Quarto 对于 Markdown 的处理仅仅只是将文件后缀由 md 改为了 qmd，并在 yaml 中输入参数即可。（当然 Quarto 也有独属的 Markdown 书写方言，起强化 Markdown 排版作用）</p><p>本文的重点会聚焦于怎么用 Quarto 将 Markdown 输出为 GFM、Word、PDF 文档，侧重于文档写作。至于写代码、写博客、写书部分，限于篇幅，建议去看<a href="https://quarto.org/docs/guide/">官方文档</a>。</p><h2 id="quarto-环境配置"><a class="markdownIt-Anchor" href="#quarto-环境配置"></a> Quarto 环境配置</h2><p>在 <a href="https://quarto.org/docs/get-started/">Quarto - Get Started</a> 页面下载 Quarto Cli 软件，然后选择你喜欢的编辑器搭配环境即可。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/50f47788/image-20221119153936-9ercyyi.png"></div></div>​</p><p>我这里推荐的是 VSCode。微软有两种软件：一种是 VSCode，一种是其他软件。只要你吹 VSCode，我们就是好朋友。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/50f47788/image-20221117114653-3cei725.png"></div></div>​</p><p>要在 VSCode，只需要安装 <a href="https://marketplace.visualstudio.com/items?itemName=quarto.quarto">vscode-quarto</a> 插件，即可开箱使用。</p><p>用 VSCode 有几个好处</p><ul><li>Quarto 插件可以提供基本的语法提示功能，还有 Github Copilot 来 AI 提示。</li><li>文件夹内各种格式随意创建：<code>.ipynb</code>​、<code>.qmd</code>​、<code>.md</code>​、<code>.py</code>​、<code>.R</code>​</li><li>VSCode 有 LaTeX 插件，可以用 Quarto 导出 ducument.tex，再用网上的模板渲染成自己需要的文档格式。</li></ul><blockquote><p>注 1：</p><p>虽然这里只介绍用 VSCode，但 Quarto 本家的 RStudio 对 Quarto 的适配也非常好，代码运行结果可以直接在代码块显示（VSCode 只能输出在终端或者渲染在最终文档里），可以切换为 Visual 模式（类似于 Markdown 笔记软件的即时渲染模式），Visual 模式支持斜杆命令输入各种块。所以还是很强大的。但本人是坚定的 VSCode 拥护者，RStudio 只能是陪衬辅助，不会是主力。</p></blockquote><blockquote><p>注 2：</p><p>VSCode 用 qmd 写 R 代码其实不是很方便，如果要用 VSCode 写 R 代码，我个人是建议用 jupyter 写，然后用 <code>quarto convert xxx.ipynb</code> ​转换为 qmd，再进行渲染。嫌麻烦的话还是建议用 RStudio 吧。</p></blockquote><p>如果你需要导出 pdf，又没有 LaTeX 环境，可以用 quarto install 安装 mini 版的 tinytex</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quarto install tinytex --update-path</span><br></pre></td></tr></table></figure><h2 id="个人用quarto的流程"><a class="markdownIt-Anchor" href="#个人用quarto的流程"></a> 个人用Quarto的流程</h2><p>先在思源笔记内写稿子，导出为md，将md后缀改为qmd，在开头加上YMAL头进行渲染设置，点击VSCode右上方的渲染按钮进行渲染，得到文档。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/50f47788/image-20221119160350-4c1ulmg.png"></div></div>​</p><h2 id="qmd-补充语法简单介绍"><a class="markdownIt-Anchor" href="#qmd-补充语法简单介绍"></a> qmd 补充语法简单介绍</h2><p>Quarto 相比于 GFM，还是加了一些自己的排版语法的，具体可以去官方文档的 <a href="https://quarto.org/docs/authoring/markdown-basics.html">Authoring</a> 章节查看。</p><p>我这里只提几点</p><h3 id="图片"><a class="markdownIt-Anchor" href="#图片"></a> 图片</h3><p>图标标注：如果开启了图片编号，默认 alt 文本会作为图片的标注，title 是不会作为标题的（不知道有没有配置选项，目前还找不到）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image src title %&#125;</span><br></pre></td></tr></table></figure><p>图片调整大小</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image figure.png  %&#125;&#123;fig.width=&#x27;50%&#x27;&#125;</span><br></pre></td></tr></table></figure><p>对于 pdf 输出，众所周知，LaTeX 渲染的 pdf 图片是薛定谔式出现的，可以设置 <code>fig.pos='H'</code> ​来固定图片位置</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image figure.png  %&#125;&#123;fig.pos=&#x27;H&#x27;&#125;</span><br></pre></td></tr></table></figure><p>设置图片 label，用于交叉引用(注意，只能是 <code>#fig-</code>​+label）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image figure.png  %&#125;&#123;#fig-first&#125;</span><br></pre></td></tr></table></figure><h3 id="表格"><a class="markdownIt-Anchor" href="#表格"></a> 表格</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| fruit  | price  |</span><br><span class="line">|--------|--------|</span><br><span class="line">| apple  | 2.05   |</span><br><span class="line">| pear   | 1.37   |</span><br><span class="line">| orange | 3.09   |</span><br></pre></td></tr></table></figure><p>设置表题 <code>: Fruit prices</code>​</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| fruit  | price  |</span><br><span class="line">|--------|--------|</span><br><span class="line">| apple  | 2.05   |</span><br><span class="line">| pear   | 1.37   |</span><br><span class="line">| orange | 3.09   |</span><br><span class="line"></span><br><span class="line">: Fruit prices</span><br></pre></td></tr></table></figure><p>设置表格每列的宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| fruit  | price  |</span><br><span class="line">|--------|--------|</span><br><span class="line">| apple  | 2.05   |</span><br><span class="line">| pear   | 1.37   |</span><br><span class="line">| orange | 3.09   |</span><br><span class="line"></span><br><span class="line">: Fruit prices &#123;tbl-colwidths=&quot;[75,25]&quot;&#125;</span><br></pre></td></tr></table></figure><p>设置表格 label，用于交叉引用(注意，只能是 <code>#tbl-</code>​+label）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| fruit  | price  |</span><br><span class="line">|--------|--------|</span><br><span class="line">| apple  | 2.05   |</span><br><span class="line">| pear   | 1.37   |</span><br><span class="line">| orange | 3.09   |</span><br><span class="line"></span><br><span class="line">: Fruit prices &#123;#tbl-fruit&#125;</span><br></pre></td></tr></table></figure><h3 id="图表交叉引用"><a class="markdownIt-Anchor" href="#图表交叉引用"></a> 图表交叉引用</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">文字（见 @tbl-fruit）</span><br><span class="line">文字（见 @fig-first)</span><br></pre></td></tr></table></figure><p>渲染结果会是：</p><p>文字（见表 1）</p><p>图片（见图 1）</p><hr><p>注意：交叉引用 @ 前需要有一个空格</p><p>注意，Quarto 默认是图表题是 Figure 和 Table，如果要改为中文需要在 YAML 里添加配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">crossref:</span></span><br><span class="line">  <span class="attr">chapters:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">fig-title:</span> <span class="string">图</span>    <span class="comment"># (default is &quot;Figure&quot;)</span></span><br><span class="line">  <span class="attr">tbl-title:</span> <span class="string">表</span>     <span class="comment"># (default is &quot;Table&quot;)</span></span><br><span class="line">  <span class="attr">title-delim:</span> <span class="string">&quot;.&quot;</span>  <span class="comment"># (default is &quot; &quot;), not for pdf</span></span><br><span class="line">  <span class="attr">fig-prefix:</span> <span class="string">图</span>  <span class="comment"># (default is &quot;Figure&quot;)</span></span><br><span class="line">  <span class="attr">tbl-prefix:</span> <span class="string">表</span>    <span class="comment"># (default is &quot;Table&quot;)</span></span><br></pre></td></tr></table></figure><h3 id="文献引用"><a class="markdownIt-Anchor" href="#文献引用"></a> 文献引用</h3><p>需要准备一个 <code>references.bib</code>​，里面放入参考文献的 bibtex 或 bibLatex 格式的 metadata。</p><p>并在 YAML 里配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bibliography:</span> <span class="string">references.bib</span></span><br></pre></td></tr></table></figure><p>就可以在文献里同样用 @ 来引用参考文件了。</p><p>可以设置引用和末尾生成参考文献格式的样式</p><p>对于导出 word，用的是 pandoc 只能设置为 citeproc（最大的问题是中英文参考文献无法区分）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cite-method:</span> <span class="string">citeproc</span></span><br></pre></td></tr></table></figure><p>对于导出 pdf，可以设置更强大的 biblatex</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">cite-method:</span> <span class="string">biblatex</span></span><br></pre></td></tr></table></figure><h2 id="yaml-模板"><a class="markdownIt-Anchor" href="#yaml-模板"></a> YAML 模板</h2><p>前面扯这么多，其实这部分才是本文核心（滑稽）。</p><p>毕竟只需要将 YAML 内容粘贴到 qmd 最前面，就可以设置渲染格式了</p><h3 id="gfm-模板"><a class="markdownIt-Anchor" href="#gfm-模板"></a> GFM 模板</h3><p>官方配置文档：<a href="https://quarto.org/docs/output-formats/gfm.html">GFM Markdown</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">&quot;My Document&quot;</span></span><br><span class="line"><span class="attr">author:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;Achuan-2&quot;</span></span><br><span class="line"><span class="attr">date:</span> <span class="string">&quot;2022.11.19&quot;</span></span><br><span class="line"><span class="attr">date-format:</span> <span class="string">&quot;YYYY.MM.DD&quot;</span></span><br><span class="line"><span class="attr">toc:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">crossref:</span></span><br><span class="line">  <span class="attr">chapters:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">fig-title:</span> <span class="string">图</span>    <span class="comment"># (default is &quot;Figure&quot;)</span></span><br><span class="line">  <span class="attr">tbl-title:</span> <span class="string">表</span>     <span class="comment"># (default is &quot;Table&quot;)</span></span><br><span class="line">  <span class="attr">title-delim:</span> <span class="string">&quot;.&quot;</span>  <span class="comment"># (default is &quot; &quot;), not for pdf</span></span><br><span class="line">  <span class="attr">fig-prefix:</span> <span class="string">图</span>  <span class="comment"># (default is &quot;Figure&quot;)</span></span><br><span class="line">  <span class="attr">tbl-prefix:</span> <span class="string">表</span>    <span class="comment"># (default is &quot;Table&quot;)</span></span><br><span class="line"><span class="attr">format:</span> </span><br><span class="line">  <span class="attr">gfm:</span></span><br><span class="line">      <span class="attr">html-math-method:</span> <span class="string">katex</span> <span class="comment"># webtex, mathjax, katex</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><ul><li>在于生成的md，是带有交叉引用功能的（通过html锚点实现）</li><li>可以把公式转换为图片（webtex），以用于不支持katex的网站</li></ul><h3 id="word-模板"><a class="markdownIt-Anchor" href="#word-模板"></a> Word 模板</h3><p>官方配置文档：<a href="https://quarto.org/docs/reference/formats/docx.html#title-author">Word</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">&quot;My Document&quot;</span></span><br><span class="line"><span class="attr">format:</span></span><br><span class="line">  <span class="attr">docx:</span></span><br><span class="line">    <span class="attr">toc:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">number-sections:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">highlight-style:</span> <span class="string">github</span></span><br><span class="line">    <span class="attr">code-line-numbers:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">link-citations:</span> <span class="literal">true</span>  <span class="comment"># 设置正文引用可以超链接到参考文献表中相应的条目，默认为 false，当然true啦</span></span><br><span class="line">    <span class="attr">reference-section-title:</span> <span class="string">&quot;参考文献&quot;</span></span><br><span class="line">    <span class="attr">bibliography:</span> <span class="string">references.bib</span></span><br><span class="line">    <span class="attr">reference-doc:</span> <span class="string">&quot;F:\\OneDrive\\文档\\模板\\ref.docx&quot;</span></span><br><span class="line">    <span class="attr">csl:</span> <span class="string">&quot;gb-t-7714-2015-numeric-bilingual-no-uppercase-no-url-doi.csl&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>导出 Word 部分，其实用的就是 pandoc，但是相比 pandoc 就更方便了，写完直接点击渲染按钮就可以。如何设置 word 模板可以见之前写的：<a href="https://www.achuan-2.top/posts/bc4b56d9.html">设置word模板，Markdown 也能自动转换为美观规范的 Word 文档</a>。里面也分享了我用的 word 文档。</p><h3 id="中文-pdf-模板"><a class="markdownIt-Anchor" href="#中文-pdf-模板"></a> 中文 PDF 模板</h3><p>官方配置文档：<a href="https://quarto.org/docs/output-formats/pdf-basics.html">PDF</a></p><p>对于 LaTex 真是又爱又恨，看 PDF 的 YAML 设置这么长就知道了，orz。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">&quot;My Document&quot;</span></span><br><span class="line"><span class="attr">author:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;Achuan-2&quot;</span></span><br><span class="line"><span class="attr">date:</span> <span class="string">&quot;2022.11.19&quot;</span></span><br><span class="line"><span class="attr">date-format:</span> <span class="string">&quot;YYYY.MM.DD&quot;</span></span><br><span class="line"><span class="attr">toc:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">number-sections:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">shift-heading-level-by:</span> <span class="number">-1</span></span><br><span class="line"><span class="attr">monofont:</span> <span class="string">&quot;Consolas&quot;</span></span><br><span class="line"><span class="attr">crossref:</span></span><br><span class="line">  <span class="attr">chapters:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">fig-title:</span> <span class="string">图</span>    <span class="comment"># (default is &quot;Figure&quot;)</span></span><br><span class="line">  <span class="attr">tbl-title:</span> <span class="string">表</span>     <span class="comment"># (default is &quot;Table&quot;)</span></span><br><span class="line">  <span class="attr">title-delim:</span> <span class="string">&quot;-&quot;</span>  <span class="comment"># (default is &quot;:&quot;), not for pdf</span></span><br><span class="line">  <span class="attr">fig-prefix:</span> <span class="string">图</span>  <span class="comment"># (default is &quot;Figure&quot;)</span></span><br><span class="line">  <span class="attr">tbl-prefix:</span> <span class="string">表</span>    <span class="comment"># (default is &quot;Table&quot;)</span></span><br><span class="line"><span class="attr">format:</span> </span><br><span class="line">  <span class="attr">pdf:</span></span><br><span class="line">    <span class="comment"># toc</span></span><br><span class="line">    <span class="attr">toc-depth:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">toc-title:</span> <span class="string">Contents</span></span><br><span class="line">    <span class="comment"># cite</span></span><br><span class="line">    <span class="attr">cite-method:</span> <span class="string">biblatex</span> <span class="comment"># biblatex,citeproc</span></span><br><span class="line">    <span class="attr">bibliography:</span> <span class="string">references.bib</span></span><br><span class="line">    <span class="attr">biblio-title:</span> <span class="string">References</span></span><br><span class="line">    <span class="comment"># output</span></span><br><span class="line">    <span class="attr">documentclass:</span> <span class="string">article</span> <span class="comment"># scrartcl，article, report or book</span></span><br><span class="line">    <span class="attr">papersize:</span> <span class="string">a4</span> <span class="comment"># a4, letter</span></span><br><span class="line">    <span class="attr">colorlinks:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#classoption: [twocolumn,landscape] </span></span><br><span class="line">    <span class="attr">keep-tex:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fig-pos:</span> <span class="string">&#x27;H&#x27;</span></span><br><span class="line">    <span class="attr">tbl-cap-location:</span> <span class="string">top</span></span><br><span class="line">    <span class="attr">fig-cap-location:</span> <span class="string">bottom</span></span><br><span class="line">    <span class="attr">listings:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">code-block-bg:</span> <span class="string">&#x27;#f6f8fa&#x27;</span></span><br><span class="line">    <span class="attr">highlight-style:</span> <span class="string">github</span></span><br><span class="line">    <span class="attr">code-block-border-left:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">geometry:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">top=30mm</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">left=20mm</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">heightrounded</span></span><br><span class="line">    <span class="attr">include-in-header:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        \usepackage&#123;ctex&#125;    % CJK 包</span></span><br><span class="line"><span class="string">        \usepackage[backend=biber,style=gb7714-2015,gbnamefmt=lowercase]&#123;biblatex&#125;</span></span><br><span class="line"><span class="string">        \usepackage[dvipsnames]&#123;xcolor&#125;</span></span><br><span class="line"><span class="string">        \setCJKmainfont[AutoFakeBold = &#123;2.25&#125;]&#123;宋体&#125;</span></span><br><span class="line"><span class="string">        \setmainfont&#123;Times New Roman&#125; %英文字體調整</span></span><br><span class="line"><span class="string">        \usepackage&#123;caption&#125;</span></span><br><span class="line"><span class="string">        \captionsetup[figure]&#123;labelformat=simple, labelsep=period&#125;</span></span><br><span class="line"><span class="string">        \captionsetup[table]&#123;labelformat=simple, labelsep=period&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><h2 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h2><ul><li><p>对于输出 PDF 来说，比如 <code>&lt;region&gt;</code> ​这种格式不能直接输出显示，需要改成 <code>\&lt;region\&gt;</code>​</p></li><li><p>思源导出图片会加两边加零宽字符，导致 alt 无法转化为图片标题。需要用 sublime text 等软件去掉。</p><p>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/50f47788/image-20221119144428-4xwickp.png"></div></div>​</p></li></ul><hr><p>暂时就到这里结束了，摸鱼了 1h 半写这篇文章 😁。</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> Quarto </tag>
            
            <tag> Word </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设置word模板，Markdown 也能自动转换为美观规范的 Word 文档</title>
      <link href="/posts/bc4b56d9.html"/>
      <url>/posts/bc4b56d9.html</url>
      
        <content type="html"><![CDATA[<p>首先先介绍下我为什么要将 Markdown 转换为 Microsoft Word 的文件，以及写这篇文章。</p><ol><li>正式的报告常常需要交 Word 格式的，而且需要引用参考文献。但我还是喜欢先用 Markdown 写稿子，最后再用 Word 来完善文稿内容和排版，让内容和样式相分离。</li><li>就算一些软件比如思源笔记、Typora 可以直接导出 docx 文件，但目前还不怎么不支持设置自定义的参数，导出的 docx 需要进行很大程度的修改，很费力，是重复劳动。</li></ol><p>所以这篇文章的目的就是介绍下如何更丝滑的把 Markdown 初步导出成满意的 Word 样式的，最后会点下Quarto这个更好用的工具。</p><h2 id="pandoc-基本命令"><a class="markdownIt-Anchor" href="#pandoc-基本命令"></a> Pandoc 基本命令</h2><p>先简单介绍下 Pandoc。这个是一个很强大的通用文档转换工具，可以支持大量标记语言之间的格式转换，例如 Markdown 、Microsoft Word、PowerPoint、 Jupyter Notebook、HTML、PDF、LaTeX、Wiki、EPUB 格式之间的相互转换。这篇文章里，我主要介绍 Markdown 怎么转换为 Microsoft Word 的文件。</p><p>首先先介绍 pandoc 的基本命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pandoc --citeproc --number-sections \</span><br><span class="line">--csl gb-t-7714-2015-numeric-bilingual-no-uppercase-no-url-doi.csl \</span><br><span class="line">--bibliography ref.bib -M reference-section-title=<span class="string">&quot;参考文献&quot;</span> \</span><br><span class="line">-M link-citations=<span class="literal">true</span> --reference-doc=ref.docx -s input.md -o main.docx</span><br></pre></td></tr></table></figure><p>别看到这个就跑路了，来一点点拆解：</p><ul><li><p>​<code>pandoc</code>​：执行 Pandoc 命 p 令</p></li><li><p>​<code>--citeproc</code>​：处理文献引用，也可用 <code>-C</code>​ 代替</p></li><li><p>​<code>--number-sections</code>​：对各级标题编号，形如 <code>1, 1.1, 1.1.1</code>​，也可用 <code>-N</code>​ 代替</p></li><li><p><code>--csl gb-t-7714-2015-numeric-bilingual-no-uppercase-no-url-doi.csl</code>：指定参考文献样式，中文报告一般用 GB/T 7714-2015 的格式，更多样式可以前往 <a href="https://www.zotero.org/styles">Zotero Style Repository</a> 和<a href="https://github.com/redleafnew/Chinese-STD-GB-T-7714-related-csl">redleafnew/Chinese-STD-GB-T-7714-related-csl</a>下载，需要注意的是pandoc目前不支持CSL-M的csl文件，那种多个作者能中文显示等、英文显示et al的就不能使用，会导致参考文献列表重复，需要把这类csl里的layout进行注释。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bibliography</span> <span class="attr">entry-spacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">et-al-min</span>=<span class="string">&quot;4&quot;</span> <span class="attr">et-al-use-first</span>=<span class="string">&quot;3&quot;</span> <span class="attr">second-field-align</span>=<span class="string">&quot;flush&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 取消这部分注释可以使用 CSL-M 的功能支持双语 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;layout suffix=&quot;.&quot; locale=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;text variable=&quot;citation-number&quot; prefix=&quot;[&quot; suffix=&quot;]&quot;/&gt;</span></span><br><span class="line"><span class="comment">    &lt;text macro=&quot;entry-layout&quot;/&gt;</span></span><br><span class="line"><span class="comment">  &lt;/layout&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">layout</span> <span class="attr">suffix</span>=<span class="string">&quot;.&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">variable</span>=<span class="string">&quot;citation-number&quot;</span> <span class="attr">prefix</span>=<span class="string">&quot;[&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;]&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">macro</span>=<span class="string">&quot;entry-layout&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bibliography</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>​<code>--bibliography ref.bib</code>​：引文数据文件，类似下面这样。在 md 文档里可以用 <code>描述 [@key]</code>​ 的方式进行引用文献，比如 <code>谷歌学术nb[@董文鸳2011我国谷歌学术搜索研究综述]</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@article&#123;董文鸳2011我国谷歌学术搜索研究综述,</span><br><span class="line">    title   = &#123;我国谷歌学术搜索研究综述&#125;,</span><br><span class="line">    author  = &#123;董文鸳&#125;,</span><br><span class="line">    journal = &#123;新世纪图书馆&#125;,</span><br><span class="line">    number  = &#123;9&#125;,</span><br><span class="line">    pages   = &#123;43--45&#125;,</span><br><span class="line">    year    = &#123;2011&#125;,</span><br><span class="line">    langid = &#123;chinese&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>​<code>-M reference-section-title=&quot;参考文献&quot;</code>​：设置参考文献表的标题为「参考文献」</p></li><li><p>​<code>-M link-citations=true</code>​：设置正文引用可以超链接到参考文献表中相应的条目，默认为 <code>false</code>​</p></li><li><p>​<code>--reference-doc ref.docx</code>​：参考的 docx 文件格式模板</p></li><li><p>​<code>input.md</code>​：存储文章内容的 Markdown 文件</p></li><li><p>​<code>-o main.docx</code>​：输出 docx 文件</p></li><li><p>​<code>\</code>​：反斜杠，表示换行，你也可以删除它，把所有命令写在一行。</p></li></ul><p>‍</p><h2 id="如何生成和修改模板"><a class="markdownIt-Anchor" href="#如何生成和修改模板"></a> 如何生成和修改模板</h2><h3 id="生成简陋的模板文件"><a class="markdownIt-Anchor" href="#生成简陋的模板文件"></a> 生成简陋的模板文件</h3><p>根据创建的md基本样式文件 <code>basic.md</code> 生成一个 docx 文件，这个文件我上传到了 <a href="https://github.com/Achuan-2/mini/blob/main/pandoc/basic.md">GitHub</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pandoc --citeproc \</span><br><span class="line">--csl gb-t-7714-2015-numeric-bilingual-no-uppercase-no-url-doi.csl \</span><br><span class="line">--bibliography ref.bib -M reference-section-title=<span class="string">&quot;参考文献&quot;</span> \</span><br><span class="line">-M link-citations=<span class="literal">true</span> -s basic.md -o templates.docx</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以预览下生成这个 <a href="https://github.com/Achuan-2/mini/blob/main/pandoc/templates.docx">docx</a> 文件，这个默认生成的样式特别难看，标题喜欢用蓝色，和中文报告的格式非常不一致。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-dGSQBqY-20221106232924-nlbef1t.png"></div></div>​<p>‍</p><p>接着我们会将这个 docx 文件的样式进行修改，以后就可以当成模板，省心省力的把 md 导出成符合格式要求的 word 文件了。</p><h3 id="如何修改模板文件"><a class="markdownIt-Anchor" href="#如何修改模板文件"></a> 如何修改模板文件</h3><p>需要注意的是这里修改模板样式，不是直接修改内容里的样式，必须要修改 word 的样式</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106224812-rjzrjek-20221106232924-opss6v5.png" alt="调出样式表"></div><div class="image-meta"><span class="image-caption center">调出样式表</span></div></div>​<p>以标题举例</p><p>点击一个标题之后，右侧样式表就会自动选择【标题 1】</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106224959-k87y6cs-20221106232924-0gqycae.png"></div></div>​<p>接着我们右击，选择修改</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106222531-1xkzz2y-20221106232925-t4cww2u.png"></div></div>​<p>把标题 1 的样式修改为</p><ul><li>字号：小二</li><li>字体：中文黑体，英文 Times New Roman</li><li>居中</li><li>段前分页</li></ul><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106222805-f9lccwq-20221106232925-5rr09yy.png" alt="修改标题1的样式"></div><div class="image-meta"><span class="image-caption center">修改标题1的样式</span></div></div>​<p>这个例子就算举好了，其他标题、正文等样式都以此类推</p><p>但有几个样式我再额外提一下</p><p>代码块样式 Source Code，我是加了在【边框和底纹】添加了灰色的边框和底纹</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106222953-1bxxsls-20221106232925-ix0woo1.png" alt="代码块样式"></div><div class="image-meta"><span class="image-caption center">代码块样式</span></div></div>​<p>表格样式 Table，我设置的是三线表，具体怎么做可以参考知乎<a href="https://zhuanlan.zhihu.com/p/33000931">这篇教学</a>，把表格上下的边框设置为 1.5 磅，表头下面的边框设置为 0.75 磅。需要注意的是表格的修改必须全选中表格后，在【表设计-修改表格样式】这里修改，修改的样式名称需要是【Table】</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106223758-049j6cb-20221106232925-is1cpx9.png"></div></div>​<p>另外我给这份模板还自动加了编号，这是因为我觉得 pandoc 虽然本身有–number-sections 参数，但是这个只是人为加上的，编号不会随着标题变化而变化，其实没有大用。在 word 里给标题编号除了让结构更清晰以外，还有一个重要的作用是让表格和图片的题注自动编号！</p><p>如何设置多级标题我这里只点一下，网上教程很多<br>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106224628-5870vl0-20221106232925-vpklj9f.png"></div></div></p><h3 id="修改之后的模板"><a class="markdownIt-Anchor" href="#修改之后的模板"></a> 修改之后的模板</h3><p>大概是这样，可能导出 word 之后还不能直接上交，还需要稍微修改，但是模板能够把主要样式以及字体设置完毕之后，已经省下了很多很多力气了，可以更愉快的用 md 来写稿，word 上交了。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/bc4b56d9/net-img-image-20221106222340-5c1qk3g-20221106232925-eg41pat.png"></div></div><p>最后的模板文件可以点击<a href="https://github.com/Achuan-2/mini/blob/main/pandoc/templates_refine.docx">下载​</a></p><h2 id="以后导出使用模板"><a class="markdownIt-Anchor" href="#以后导出使用模板"></a> 以后导出使用模板</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pandoc --citeproc \</span><br><span class="line">--csl gb-t-7714-2015-numeric-bilingual-no-uppercase-no-url-doi.csl \</span><br><span class="line">--bibliography ref.bib -M reference-section-title=<span class="string">&quot;参考文献&quot;</span> \</span><br><span class="line">-M link-citations=<span class="literal">true</span> --reference-doc=template.docx -s input.md  -o output.docx</span><br></pre></td></tr></table></figure><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><p>总结下 pandoc 将 md 导出 docx 格式的优点</p><ul><li>导出速度很快，几乎在几秒内。相较于很重的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 渲染，简直轻快极了！</li><li>可以设置模板的样式进行复用。</li><li>支持参考文献引用（并且支持超链接点击跳转，zotero 我都找不到方式实现……）</li><li>后续可以直接在Word里修改内容，不像<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span>导出pdf，修改内容就得重新渲染</li></ul><p>当然也有一些缺点啦，一些样式的处理比如代码块实现不了太精致的样式，参考文献 csl 格式不支持多语言识别，导出之后可能还需要后期调整样式，例如表格和图片大小，等等。</p><p>总的来说，这种方式对于喜欢用 md 写稿，又需要交 word 文件的人，还是帮助很大很大的。像少数派<a href="https://sspai.com/post/64842">这篇文章</a>，就介绍了自己为什么不用 word 写稿、为什么不用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 写稿的原因，感兴趣可以看看。</p><p>最后，本文介绍的这种通过命令行调用 pandoc 导出 md 为 docx 的方式还是非常繁琐的，而且写稿与导出其实是分离开的。</p><p>下一篇文章我将会主要介绍 <a href="https://quarto.org/">Quarto</a> 这个工具。Quarto 是下一代的 Rmarkdown，相比 Rmarkdown 来说，把生态给大一统了，你甚至不需要有 R 环境也能用，VSCode 上也有专门的<a href="https://marketplace.visualstudio.com/items?itemName=quarto.quarto">插件</a>。Quarto 的强大之处在于，不仅仅在于可以渲染代码运行结果，而且导出文档方面是我目前见过最无敌的存在，相信我，用上它，你会见到 markdown 的另一片天空。你只需要把 md 改成 qmd 后缀，加上一个 yaml 头，轻轻一点渲染按钮，就可以导出 word、html、ipynb、GFM 规范的 md（还可以设置公式导出为纯文本还是图片），甚至当成简易版的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.89883em;vertical-align:-0.2155em;"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-0.36em;"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span style="top:-2.904999em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.15em;"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.46782999999999997em;"><span style="top:-2.7845em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2155em;"><span></span></span></span></span><span class="mspace" style="margin-right:-0.125em;"></span><span class="mord textrm">X</span></span></span></span></span></span> 代码与 markdown 语法混用，导出样式精美的 pdf。好啦，这里就不多说了，等我下篇博客吧。</p><hr><p>本文涉及的文件已上传至<a href="https://github.com/Achuan-2/mini/tree/main/pandoc">GitHub</a></p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> Word </tag>
            
            <tag> pandoc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 笔记本电脑查看电池使用情况</title>
      <link href="/posts/e977bfe7.html"/>
      <url>/posts/e977bfe7.html</url>
      
        <content type="html"><![CDATA[<p>不需要其他软件，直接用cmd命令就可以。</p><p>在cmd窗口输入<code>powercfg /batteryreport</code>，生成电池使用情况报告html，</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/Snipaste_2022-09-04_22-34-50-20220904223452-x48xwgp.png"></div></div>​<p>打开html，可以看到详细的电池报告。</p><p>Installed batteries这里，最重要的两个信息是Design capacity(电池设计容量)和Full charge capacity(满电容量)，这两个信息是通过读取电池信息得到的。我们可以粗略通过这两个数据判断电池是否有衰减，如果发现“FULL CHARGE CAPACITY”大幅小于“DESIGN CAPACITY”，那么电池衰减可能就比较厉害了</p><p>下图中，Design capacity=Full charge capacity这是由于我已经换了新电池。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/Snipaste_2022-09-04_22-36-04-20220904223606-zys549c.png"></div></div>​<p>往下翻，还有几栏信息，可以帮助了解电池状态。</p><ul><li><p>Recent usage观察到电池近三天的电量变化情况，有表格还带有图表。在“STATE”（状态）中，有“Active”（活动）和“Connected standby”（连接待机）等情况，而“SOURCE”（电源）中，则可以观察到电源来自“Battery”（电池）还是“AC”（交流电）。之后一栏“CAPACITY REMAINING”则是电池电量的变化了，判断电脑掉电快到底是耗电异常还是容量衰减，这个数据很有参考价值。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/Snipaste_2022-09-04_23-05-38-20220904230542-bao9xjm.png"></div></div>​</li><li><p>在“Usage history”一栏中，可以看到电脑每天“ACTIVE”（活动）和“CONNECTED STANDBY”（连接待机）的时长。有时候电量消耗太快是因为电脑莫名其妙唤醒，没有待机，在这里可以查看耗电太多是不是这一原因。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/Snipaste_2022-09-04_23-09-17-20220904230921-xjycjwl.png"></div></div>​</li><li><p>Battery capacity history可以看过去电池容量的变化，下图可以看到2020年11月我电脑电池实际容量只有15Wh了，后来在2020年11月底电池容量突然恢复正常了。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/Snipaste_2022-09-04_22-37-54-20220904223801-yudlq5i.png"></div></div>​<p>为什么呢？这是因为我在这时候换了一个新电池，我重新找了淘宝的购物记录，发现确实就是这时候买的电池。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/image-20220904224059-f1uk6ui.png"></div></div>​<p>然后再往下滑，可以看到现在的电池容量也只有大约22Wh了，不用充电器大概只能支持40min这样（大概才用了1年9个月）。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/e977bfe7/Snipaste_2022-09-04_22-30-27-20220904223124-9jlxnuy.png"></div></div>​</li></ul><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><ul><li>在cmd命令行中使用<code>powercfg /batteryreport</code>可以很详细的查看当前电池实际容量来预估电池寿命，还可以追踪过去电池的实际容量变化。</li><li>虽然这个Windows自带的电池检测功能用起来是麻烦了点，但对比第三方软件，它更加靠谱，展示的信息也更多。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tree 查看文件目录神器</title>
      <link href="/posts/595885f1.html"/>
      <url>/posts/595885f1.html</url>
      
        <content type="html"><![CDATA[<h2 id="使用"><a class="markdownIt-Anchor" href="#使用"></a> 使用</h2><p>tree能以树状图列出目录的内容，非常适合概览项目结构。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> tree=<span class="string">&#x27;tree -FCN&#x27;</span></span><br><span class="line">tree -L 2</span><br></pre></td></tr></table></figure><ul><li>-F 在执行文件，目录，Socket，符号连接，管道名称名称，各自加上&quot;*“,”/“,”=“,”@“,”|&quot;号</li><li>-C 在文件和目录清单加上色彩，便于区分各种类型。</li><li>-N 直接列出文件和目录名称，包括控制字符。</li><li>-L 设置展开层级</li></ul><div class="tag-plugin image"><div class="image-bg"><img src="/posts/595885f1/1667494832744.png"></div></div>​<h2 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2><h3 id="linux无权限安装"><a class="markdownIt-Anchor" href="#linux无权限安装"></a> Linux无权限安装</h3><ol><li>通过链接地址: <a href="http://mama.indstate.edu/users/ice/tree/">http://mama.indstate.edu/users/ice/tree/</a>下载 tree 安装包。或者使用wget命令：<code>wget http://mama.indstate.edu/users/ice/tree/src/tree-1.8.0.tgz</code>（版本不要安装太新的，可能编译有问题）</li><li>使用指令 <code>tar -zxvf tree-1.8.0.tgz</code> 解压。</li><li>进入解压目录，编辑目录中的 Makefile 文件，将 prefix=后面的路径改为自己的安装目录，比如我的改为 <code>prefix = /home/achuan/softwares/tree-1.8.0</code>，保存。</li><li>在解压目录，输入指令 make install 进行安装。</li><li>编辑用户目录(~）下 <code>vi ~/.bashrc</code> 或 <code>vi ~.bash_profile</code> ，加入以下内容：export <code>PATH=$PATH:/home/achuan/softwares/tree-1.8.0/bin</code></li><li>输入 <code>source ~/.bashrc</code> 或 <code>source ~/.bash_profile</code> 指令更新。</li></ol><h3 id="windows-git-bash安装"><a class="markdownIt-Anchor" href="#windows-git-bash安装"></a> windows Git Bash安装</h3><ul><li>打开进入 <a href="https://gnuwin32.sourceforge.net/packages/tree.htm">Tree for Windows</a> 页面，选择下载 Binaries zip 文件。</li><li>解压压缩包，找到压缩包内的 bin 目录，将 bin 目录下的 tree.exe 复制</li><li>找到安装Git的文件夹，找到该文件夹下的usr\bin 目录，将 tree.exe 粘贴到该目录下，安装即完成</li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 上传包到pypi</title>
      <link href="/posts/d2b2fba7.html"/>
      <url>/posts/d2b2fba7.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>要学会可以创建属于自己的轮子！</p></blockquote><p>阿巛同学第一个上传到Pypi的包：<a href="https://pypi.org/project/pairwiseAlignment/">https://pypi.org/project/pairwiseAlignment/</a></p><h2 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作"></a> 准备工作</h2><ul><li><p>注册<a href="https://pypi.org/">pypi</a>，创建一个<code>$HOME/.pypirc</code>​文件，里面填入token（在<a href="https://pypi.org/manage/account/">Account settings </a>获取）</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pypi]</span></span><br><span class="line">  <span class="attr">username</span> = __token__</span><br><span class="line">  <span class="attr">password</span> = pypi生成的token</span><br></pre></td></tr></table></figure></li><li><p>把之前的代码文件全部放入一个新的文件夹里，在外部生成下面这些文件</p><ul><li><p><a href="http://README.md">README.md</a></p></li><li><p><a href="http://setup.py">setup.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup,find_packages</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> PairwiseAlignment <span class="keyword">import</span> __version__</span><br><span class="line"></span><br><span class="line">here = path.abspath(path.dirname(__file__))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path.join(here, <span class="string">&#x27;requirements.txt&#x27;</span>), <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    all_reqs = f.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    install_requires = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> all_reqs <span class="keyword">if</span> <span class="string">&#x27;git+&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> x]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path.join(here, <span class="string">&#x27;README.md&#x27;</span>), <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    long_description = f.read()</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&#x27;pairwiseAlignment&#x27;</span>,  <span class="comment"># 必填，项目的名字，用户根据这个名字安装，pip install pairwiseAlignment</span></span><br><span class="line">    version=__version__, <span class="comment"># 必填，项目的版本，建议遵循语义化版本规范</span></span><br><span class="line">    author=<span class="string">&#x27;Achuan-2&#x27;</span>,  <span class="comment"># 项目的作者</span></span><br><span class="line">    description=<span class="string">&#x27;Using Python to implement Needleman Wunsch and Smith Waterman algorithms&#x27;</span>,  <span class="comment"># 项目的一个简短描述</span></span><br><span class="line">    long_description=long_description,  <span class="comment"># 项目的详细说明，通常读取 README.md 文件的内容</span></span><br><span class="line">    long_description_content_type=<span class="string">&#x27;text/markdown&#x27;</span>,  <span class="comment"># 描述的格式，可选的值： text/plain, text/x-rst, and text/markdown</span></span><br><span class="line">    author_email=<span class="string">&#x27;achuan-2@outlook.com&#x27;</span>,  <span class="comment"># 作者的有效邮箱地址</span></span><br><span class="line">    url=<span class="string">&#x27;https://github.com/Achuan-2/mini/tree/main/pairwiseAlignment&#x27;</span>,  <span class="comment"># 项目的源码地址</span></span><br><span class="line">    include_package_data=<span class="literal">True</span>,</span><br><span class="line">    py_modules=[<span class="string">&#x27;pairwiseAlignment&#x27;</span>],</span><br><span class="line">    platforms=<span class="string">&#x27;any&#x27;</span>, <span class="comment"># 项目的运行平台，可选的值：any, windows, linux, macos, unix, os2, ce, java, and riscos</span></span><br><span class="line">    packages=find_packages(), <span class="comment"># 项目的包列表，如果项目只有一个包，那么这个参数可以省略</span></span><br><span class="line">    python_requires=<span class="string">&#x27;&gt;=3.7&#x27;</span>,  <span class="comment"># 项目的 Python 版本要求</span></span><br><span class="line">    license=<span class="string">&#x27;MIT&#x27;</span>, <span class="comment"># 项目的许可证</span></span><br><span class="line">    install_requires=install_requires,</span><br><span class="line">    <span class="comment">#  下面的设置将在命令行提供一个叫做 pairwiseAlignment 的命令，用来执行 main.py 的 main 方法</span></span><br><span class="line">    entry_points=&#123;</span><br><span class="line">        <span class="string">&#x27;console_scripts&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;pairwiseAlignment= PairwiseAlignment.run:main&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>LICENSE.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Copyright (c) 2022 The Python Packaging Authority</span><br><span class="line"> </span><br><span class="line">Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line">of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line">in the Software without restriction, including without limitation the rights</span><br><span class="line">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line">copies of the Software, and to permit persons to whom the Software is</span><br><span class="line">furnished to do so, subject to the following conditions:</span><br><span class="line"> </span><br><span class="line">The above copyright notice and this permission notice shall be included in all</span><br><span class="line">copies or substantial portions of the Software.</span><br><span class="line"> </span><br><span class="line">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span><br><span class="line">SOFTWARE.</span><br></pre></td></tr></table></figure></li><li><p><a href="http://MANIFEST.in">MANIFEST.in</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include requirements.txt</span><br><span class="line">include README.md</span><br></pre></td></tr></table></figure></li><li><p>requirements.txt</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipreqs ./ --encoding=utf8</span><br></pre></td></tr></table></figure></li></ul></li><li><p>之后目录架构</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|-- PairwiseAlignment/（要上传的代码方在一个文件夹）</span><br><span class="line">|   |-- __init__.py</span><br><span class="line">|   |-- __pycache__/</span><br><span class="line">|   |-- run.py</span><br><span class="line">|   `-- src/</span><br><span class="line">|-- CHANGELOG.md</span><br><span class="line">|-- LICENSE.txt</span><br><span class="line">|-- MANIFEST.in</span><br><span class="line">|-- README.md</span><br><span class="line">|-- requirements.txt</span><br><span class="line">`-- setup.py</span><br></pre></td></tr></table></figure><ul><li>由于现在代码变为包了，所以要注意包内的自定义模块导入方式，比如.代表同级，…代表上一级</li></ul></li><li><p>安装所需要的包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install build</span><br><span class="line">pip install twine</span><br></pre></td></tr></table></figure></li></ul><h2 id="测试"><a class="markdownIt-Anchor" href="#测试"></a> 测试</h2><p>直接安装测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><p>运行对于程序的命令，检测有无问题</p><h2 id="上传"><a class="markdownIt-Anchor" href="#上传"></a> 上传</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -m build <span class="comment"># 打包</span></span><br><span class="line">twine upload dist/* <span class="comment"># 上传包到pypi</span></span><br><span class="line"><span class="built_in">rm</span> -r dist build *.egg-info <span class="comment"># 删除临时文件</span></span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RNAseq 分析：Tophat2+cufflinks+cuffdiff+差异基因分析</title>
      <link href="/posts/6e57daa8.html"/>
      <url>/posts/6e57daa8.html</url>
      
        <content type="html"><![CDATA[<div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/pipeline-20221023131537-gg5rnwh.svg" alt="本次分析的整体流程"></div><div class="image-meta"><span class="image-caption center">本次分析的整体流程</span></div></div>​<h2 id="一-数据来源"><a class="markdownIt-Anchor" href="#一-数据来源"></a> 一、数据来源</h2><h3 id="数据简介"><a class="markdownIt-Anchor" href="#数据简介"></a> 数据简介</h3><p>本次分析的数据来源于在 2020 年五月发表在 Nucleic Acids Res 的《Nono deficiency compromises TET1 chromatin association and impedes neuronal differentiation of mouse embryonic stem cells》（doi: <a href="https://doi.org/10.1093/nar/gkaa213">10.1093/nar/gkaa213</a>）。该文由复旦大学生物医学研究所表观遗传学实验室，哈佛大学医学院附属布莱根妇女医院内分泌系、哈佛大学医学院附属波士顿儿童医院新生医学与表观遗传学研究室共同发表，第一作者为 Wenjing Li 和 Violetta Karwacki-Neisius，石雨江教授和吴飞珍副研究员为共同通讯作者。该文涉及的代码见 <a href="https://github.com/FeizhenWu/Nono">FeizhenWu/Nono</a>。</p><p>NONO 是一种 DNA/RNA 结合蛋白，该文揭示了 <strong>NONO在小鼠胚胎干细胞(mESCs)的神经元分化过程中起着关键作用，Nono缺失会影响到TET1与染色质结合并阻碍小鼠胚胎干细胞的神经分化</strong>：Nono 基因缺失将使得神经元分化的关键特定基因上调失败，从而阻碍了神经元谱系的定型；许多 NONO 调控的基因也是 DNA 去甲基化酶 TET1 的靶向基因；将野生型 NONO 蛋白重新引入 NONO KO 细胞，不仅使得大部分 NONO/TET1 共调控基因的恢复正常表达，还可以挽救 NONO 缺陷的 mESCs 的神经分化缺陷；作者还发现 NONO 能通过其 DNA 结合域直接与 TET1 相互作用，并将 TET1 招募到基因位点以调节 5-羟甲基胞嘧啶水平。NONO 的缺失会导致 TET1 与染色质显著分离，使得神经元基因的 DNA 羟甲基化失调。</p><p>该文涉及的 RNA-seq 测序数据在 NCBI SRA 数据库编号为 <a href="https://www.ncbi.nlm.nih.gov/bioproject/PRJNA527295">PRJNA527295</a>。测序的细胞为小鼠胚胎干细胞（E14TG2a），分别对三类 mESCs 细胞进行测序（WT，Nono KO，Nono KO+WT），使用 Illumina HiSeq 2500 测序仪进行转录组 RNA 测序。</p><p>本次实验选取了四个 Run（测序数据），分别为 SRR8734708（set1_WT_D0）、SRR8734712（set1_NonoKO_D0）、SRR8734718（Set2_WT_D0）和 SRR8734722（Set2_NonoKO_D0）。</p><table><thead><tr><th>RUN</th><th>GROUP</th></tr></thead><tbody><tr><td>SRR8734708</td><td>set1_WT_D0</td></tr><tr><td>SRR8734712</td><td>set1_NonoKO_D0</td></tr><tr><td>SRR8734718</td><td>Set2_WT_D0</td></tr><tr><td>SRR8734722</td><td>Set2_NonoKO_D0</td></tr></tbody></table><h3 id="数据下载"><a class="markdownIt-Anchor" href="#数据下载"></a> 数据下载</h3><p>在服务器上创建项目文件夹 <code>mkdir ~/workplace/homework1</code>​</p><p>通过在 NCBI 的 SRA 数据库输入 SRR id，打开 <a href="https://www.ncbi.nlm.nih.gov/Traces/study/?acc=SRP188551&amp;o=acc_s%3Aa&amp;s=SRR8734722,SRR8734718,SRR8734708,SRR8734712">Run Selector</a>，选择 4 个 Run 后勾选 Selected，下载 Metadata 和 Accession List，上传到服务器项目文件夹中。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220923111615-szjl96s.png"></div></div><p>​<code>SRR_Acc_List.txt</code> ​文件内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SRR8734722</span><br><span class="line">SRR8734718</span><br><span class="line">SRR8734708</span><br><span class="line">SRR8734712</span><br></pre></td></tr></table></figure><p>服务器项目文件夹创建 <code>group.csv</code>​，记录 SRR ID 和分组信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SRR8734708,set1_WT_D0</span><br><span class="line">SRR8734712,set1_NonoKO_D0</span><br><span class="line">SRR8734718,set2_WT_D0</span><br><span class="line">SRR8734722,set2_NonoKO_D0</span><br></pre></td></tr></table></figure><p>然后在服务器上使用 sratoolkit 软件的 fastq-dump 命令进行下载测序数据。fastq-dump 可以下载 fastq 格式的文件，也可以将下载好的 sra 格式文件转换为 fastq 格式。</p><ol><li><p>配置 sratoolkit（v2.11.0）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vdb-config --interactive</span><br><span class="line"><span class="comment"># 然后按s，o，e，完成配置</span></span><br></pre></td></tr></table></figure></li><li><p>编写 slurm 作业脚本：<code>vim ~/scripts/fastq-dump.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH -J fastq-dump</span></span><br><span class="line"><span class="comment">#SBATCH -p dna</span></span><br><span class="line"><span class="comment">#SBATCH -N 1</span></span><br><span class="line"><span class="comment">#SBATCH --mem=10G</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=2</span></span><br><span class="line"><span class="comment">#SBATCH -o slurm.%j.%x.out        # STDOUT</span></span><br><span class="line"><span class="comment">#SBATCH -e slurm.%j.%x.err        # STDERR</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=END</span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=jxsu22@m.fudan.edu.cn</span></span><br><span class="line"></span><br><span class="line">fastq-dump --split-3 --gzip <span class="variable">$1</span> --outdir <span class="variable">$2</span></span><br></pre></td></tr></table></figure></li><li><p>运行 shell 脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=/home/u22211520038/workplace/homework1</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$PROJECT</span>/SRR_Acc_List.txt| <span class="keyword">while</span> <span class="built_in">read</span> <span class="built_in">id</span>;<span class="keyword">do</span></span><br><span class="line">    sbatch ~/scripts/fastq-dump.sh <span class="variable">$&#123;id&#125;</span> <span class="variable">$PROJECT</span>/01_rawdata/ </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p>下载完成</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220923232239-tkxtdyv.png" alt="cat $PROJECT/log/slurm.*.fastq-dump*.out"></div><div class="image-meta"><span class="image-caption center">cat $PROJECT/log/slurm.*.fastq-dump*.out</span></div></div>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220926232618-otpzdnj.png" alt="ll -h $PROJECT/01_rawdata/"></div><div class="image-meta"><span class="image-caption center">ll -h $PROJECT/01_rawdata/</span></div></div>​<p>​</p></li></ol><h2 id="二-分析过程"><a class="markdownIt-Anchor" href="#二-分析过程"></a> 二、分析过程</h2><h3 id="1-trim_galore-去除低质量的-reads-和-adaptor"><a class="markdownIt-Anchor" href="#1-trim_galore-去除低质量的-reads-和-adaptor"></a> 1、trim_galore 去除低质量的 reads 和 adaptor</h3><p><a href="https://github.com/FelixKrueger/TrimGalore">Trim Galore</a> 使用 Perl 语言对 <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> 和 <a href="https://github.com/marcelm/cutadapt">Cutadapt</a> 进行了封装。可以用于过滤低质量碱基和去除序列 3’ 末端的 adapter。可适用于所有高通量测序，包括 RRBS(Reduced Representation Bisulfite-Seq ),、Illumina、Nextera 和 smallRNA 测序平台的双端和单端数据。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">trim_galore --version</span></span><br><span class="line"></span><br><span class="line">                        Quality-/Adapter-/RRBS-/Speciality-Trimming</span><br><span class="line">                                [powered by Cutadapt]</span><br><span class="line">                                  version 0.6.7</span><br><span class="line"></span><br><span class="line">                               Last update: 11 05 2020</span><br></pre></td></tr></table></figure><p>参数</p><ul><li><code>--fastqc</code>：Run FastQC in the default mode on the FastQ file once trimming is complete.</li><li><code>--illumina</code>：Adapter sequence to be trimmed is the first 13bp of the Illumina universal adapter AGATCGGAAGAGC instead of the default auto-detection of adapter sequence.</li><li><code>-o/--output_dir &lt;DIR&gt;</code>：If specified all output will be written to this directory instead of the current directory. If the directory doesn’t exist it will be created for you.</li><li><code>--gzip</code>：Compress the output file with <code>gzip</code>. If the input files are gzip-compressed the output files will be automatically gzip compressed as well.</li></ul><p>实操过程</p><ol><li><p>编写 trim_galore 的 slurm 作业脚本：<code>vim ~/scripts/trim_galore.sh</code>​</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH -J trim_galore</span></span><br><span class="line"><span class="comment">#SBATCH -p dna</span></span><br><span class="line"><span class="comment">#SBATCH -N 1</span></span><br><span class="line"><span class="comment">#SBATCH --mem=20G</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=4</span></span><br><span class="line"><span class="comment">#SBATCH -o slurm.%j.%x.out        # STDOUT</span></span><br><span class="line"><span class="comment">#SBATCH -e slurm.%j.%x.err        # STDERR</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=END  # 发送哪一种email通知：BEGIN,END,FAIL,ALL</span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=jxsu22@m.fudan.edu.cn</span></span><br><span class="line"></span><br><span class="line">mode=<span class="variable">$1</span></span><br><span class="line">SRR=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$mode</span>&quot;</span> == <span class="string">&quot;single&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 如果是单端</span></span><br><span class="line">    trim_galore --illumina --fastqc  <span class="variable">$SRR</span>.fastq.gz</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$mode</span>&quot;</span> == <span class="string">&quot;paired&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 如果是多端</span></span><br><span class="line">    trim_galore --illumina --fastqc --paired <span class="variable">$&#123;SRR&#125;</span>_1.fastq.gz <span class="variable">$&#123;SRR&#125;</span>_2.fastq.gz</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li><li><p>运行 shell 脚本，将 trim_galore 作业脚本提交到 slurm 系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=/home/u22211520038/workplace/homework1</span><br><span class="line">mode=paired</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span>/01_rawdata/</span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$PROJECT</span>/SRR_Acc_List.txt| <span class="keyword">while</span> <span class="built_in">read</span> SRR;<span class="keyword">do</span> </span><br><span class="line">    sbatch ~/scripts/trim_galore.sh <span class="variable">$mode</span> <span class="variable">$SRR</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p>运行结束：在项目 <code>$PROJECT/01_rawdata/</code> ​文件夹下，新生成了双端测序的过滤文件，以 SRR8734708 测序文件为例：</p><p>​<code>SRR8734708_1.fastq.gz-&gt; SRR8734708_1_val_1.fq.gz</code>​</p><p>​<code>SRR8734708_2.fastq.gz-&gt;SRR8734708_2_val_2.fq.gz</code>​</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220927195628-y81zt42.png" alt="ll -lh $PROJECT/01_rawdata/"></div><div class="image-meta"><span class="image-caption center">ll -lh $PROJECT/01_rawdata/</span></div></div>​</li></ol><blockquote><p>如果是单端测序模式，trim_galore 则会默认生成带 trimed.fq.gz 的数据文件</p></blockquote><h3 id="2-使用-tophat2-比对和-cufflinks-计算基因表达"><a class="markdownIt-Anchor" href="#2-使用-tophat2-比对和-cufflinks-计算基因表达"></a> 2、使用 Tophat2 比对和 Cufflinks 计算基因表达</h3><p><a href="https://ccb.jhu.edu/software/tophat/index.shtml">Tophat2</a> 是一个比对工具，本身实际不能比对，而是通过调用 bowtie/bowtie2 进行比对。Tophat 最初只能调用 bowtie，2012 年 4 月 9 日 Tophat 发布了 2.0.0 版本，宣布支持 bowtie2 的比对，将其称之为 Tophat2。进行比对时，需要输入<u>基因组的索引</u>，而不是直接输入基因组序列，这是为了比对更加快速、减小计算内存，帮助比对软件更快速的找到目标区域。</p><p><a href="http://cole-trapnell-lab.github.io/cufflinks/">Cufflinks</a> 是一个主要用于基因表达量的计算和差异表达基因分析的软件包。其下主要包含 cufflinks，cuffmerge，cuffcompare 和 cuffdiff 等几支主要的程序。</p><ul><li>cufflinks 可以通过 tophat2 生成的 accepted_hits.bam 文件计算基因的 FPKM 值、输出基因组注释 gtf 文件。</li><li>cuffdiff 则可以通过 tophat2 生成的 accepted_hits.bam 文件和基因组注释 gtf 文件计算差异表达基因。</li></ul><p>实操过程</p><ol><li><p>先准备参考基因组</p><ol><li><p>参考基因组地址</p><ul><li>基因索引文件文件：<code>/home/public/share/Genomes/mm10_Bowtie2Index</code>​</li><li>基因注释文件地址：<code>/home/public/share/Genomes/mm10_genes.gtf</code>​</li></ul></li><li><p>将参考基因组软连接到项目文件夹下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=/home/u22211520038/workplace/homework1</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$PROJECT</span>/00_index</span><br><span class="line"><span class="comment"># 参考基因组</span></span><br><span class="line"><span class="built_in">ln</span> -s /home/public/share/Genomes/mm10_Bowtie2Index <span class="variable">$PROJECT</span>/00_index</span><br><span class="line"><span class="comment"># 基因注释</span></span><br><span class="line"><span class="built_in">ln</span> -s /home/public/share/Genomes/mm10_genes.gtf <span class="variable">$PROJECT</span>/00_index</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li><li><p>编写运行 tophat2 和 cufflinks 的脚本：<code>vim tophat2_cufflinks.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH -J tophat2_cufflinks</span></span><br><span class="line"><span class="comment">#SBATCH -p dna</span></span><br><span class="line"><span class="comment">#SBATCH -N 4</span></span><br><span class="line"><span class="comment">#SBATCH --mem=20G</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=4</span></span><br><span class="line"><span class="comment">#SBATCH -o slurm.%j.%x.out        # STDOUT</span></span><br><span class="line"><span class="comment">#SBATCH -e slurm.%j.%x.err        # STDERR</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=END  # 发送哪一种email通知：BEGIN,END,FAIL,ALL</span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=jxsu22@m.fudan.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Usage:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   tophat2_cufflinks.sh &#123;mode&#125; &#123;threads&#125; &#123;transcriptome-index&#125; &#123;bowtie2-index&#125; &#123;SRR&#125; &#123;fq1&#125; [&#123;fq2&#125;] &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INDEX=<span class="variable">$PWD</span>/00_index</span><br><span class="line">DATA=<span class="variable">$PWD</span>/01_rawdata</span><br><span class="line">RESULT=<span class="variable">$PWD</span>/02_result</span><br><span class="line"></span><br><span class="line">mode=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$mode</span> <span class="comment"># 检测字符是否为空</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;please input the mode(single or paired)&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">threads=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$threads</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;please input the number of threads&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">Annotation=<span class="variable">$3</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$Annotation</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;please input transcriptome-index(/share/Genomes/Homo_sapiens/UCSC/hg19/Annotation/Genes/hg19_genes/genes.gff)&quot;</span> </span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">bowtie2Index=<span class="variable">$4</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$bowtie2Index</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;please input bowtie2-index(/share/Genomes/Homo_sapiens/UCSC/hg19/Sequence/Bowtie2Index/genome)&quot;</span> </span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">SRR=<span class="variable">$5</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$SRR</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;please input SRR id&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">fq1=<span class="variable">$6</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$fq1</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;please input fasta1&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$mode</span>&quot;</span> == <span class="string">&quot;paired&quot;</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">   fq2=<span class="variable">$7</span></span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">test</span> -z <span class="variable">$fq2</span></span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;please input fasta1&quot;</span></span><br><span class="line">      <span class="built_in">exit</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#====================================================</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running info&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Project:    &quot;</span><span class="variable">$PWD</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Read:       &quot;</span><span class="variable">$SRR</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Annotation: &quot;</span><span class="variable">$Annotation</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Genome:     &quot;</span><span class="variable">$bowtie2Index</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">########################RUN##############################</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;RESULT&#125;</span>/tophat2/<span class="variable">$&#123;SRR&#125;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;RESULT&#125;</span>/cufflinks/<span class="variable">$&#123;SRR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$mode</span>&quot;</span> == <span class="string">&quot;single&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 如果是单端</span></span><br><span class="line">    tophat2 -p <span class="variable">$&#123;threads&#125;</span> -o <span class="variable">$&#123;RESULT&#125;</span>/tophat2/<span class="variable">$&#123;SRR&#125;</span> <span class="variable">$&#123;INDEX&#125;</span>/<span class="variable">$&#123;bowtie2Index&#125;</span> <span class="variable">$&#123;DATA&#125;</span>/<span class="variable">$&#123;fq1&#125;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$mode</span>&quot;</span> == <span class="string">&quot;paired&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 如果是多端</span></span><br><span class="line">    tophat2 -p <span class="variable">$&#123;threads&#125;</span> -o <span class="variable">$&#123;RESULT&#125;</span>/tophat2/<span class="variable">$&#123;SRR&#125;</span> <span class="variable">$&#123;INDEX&#125;</span>/<span class="variable">$&#123;bowtie2Index&#125;</span> <span class="variable">$&#123;DATA&#125;</span>/<span class="variable">$&#123;fq1&#125;</span> <span class="variable">$&#123;DATA&#125;</span>/<span class="variable">$&#123;fq2&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">cufflinks -p <span class="variable">$&#123;threads&#125;</span> -o <span class="variable">$&#123;RESULT&#125;</span>/cufflinks/<span class="variable">$&#123;SRR&#125;</span> -G <span class="variable">$&#123;INDEX&#125;</span>/<span class="variable">$Annotation</span> <span class="variable">$&#123;RESULT&#125;</span>/tophat2/<span class="variable">$&#123;SRR&#125;</span>/accepted_hits.bam</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; Running <span class="variable">$&#123;SRR&#125;</span> is compeleted.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span></span><br></pre></td></tr></table></figure></li><li><p>运行 shell 脚本，将该作业脚本提交到 slurm 系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=/home/u22211520038/workplace/homework1</span><br><span class="line">mode=paired</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$PROJECT</span>/SRR_Acc_List.txt | <span class="keyword">while</span> <span class="built_in">read</span> SRR;<span class="keyword">do</span></span><br><span class="line">    sbatch ~/scripts/Tophat_Cufflinks.sh \</span><br><span class="line">        <span class="variable">$mode</span> \</span><br><span class="line">        4 \</span><br><span class="line">        mm10_genes.gtf \</span><br><span class="line">        mm10_Bowtie2Index/genome \</span><br><span class="line">        <span class="variable">$&#123;SRR&#125;</span> \</span><br><span class="line">        <span class="variable">$&#123;SRR&#125;</span>_1_val_1.fq.gz \</span><br><span class="line">        <span class="variable">$&#123;SRR&#125;</span>_2_val_2.fq.gz </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p>运行结束：在项目 $PROJECT/02_result/文件夹下，tophat2 和 cufflinks 文件夹分别存放两个软件运行的结果。</p><ol><li><p>tophat2 的运行结果</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220928193453-vtzwja0.png" alt="tree -L 2 ${Project}/02_result/tophat2"></div><div class="image-meta"><span class="image-caption center">tree -L 2 ${Project}/02_result/tophat2</span></div></div>​<p>其中最有用的是 accepted_hits.bam，记录了 reads 比对到参考基因组的数据</p></li><li><p>cufflinks 的运行结果：</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220928192709-10579bp.png"></div></div>​<p>其中常用的是 <code>genes.fpkm_tracking</code> 和 <code>transcripts.gtf</code> 文件</p><ul><li><code>genes.fpkm_tracking</code>：isoforms (可以理解为 gene 的各个外显子)的 fpkm 计算结果；</li><li><code>transcripts.gtf</code>：转录组的 gtf，该文件包含 Cufflinks 的组装结果 isoforms；</li></ul></li></ol></li></ol><h3 id="3-fpkm-转化为-tpm"><a class="markdownIt-Anchor" href="#3-fpkm-转化为-tpm"></a> 3、FPKM 转化为 TPM</h3><p>在 RNA-Seq 的分析中，需要对基因或转录本的 read counts 数目进行标准化（normalization）。因为落在一个基因区域内的 read counts 数目取决于基因长度和测序深度，一个基因越长，测序深度越高，落在其内部的 read counts 数目就会相对越多。在进行基因差异表达的分析时，往往是在多个样本中比较不同基因的表达量，如果不进行数据标准化，比较结果是没有意义的。read counts 数目标准化的两个关键因素就是基因长度和测序深度，常常用 RPKM (Reads Per Kilobase Million), FPKM (Fragments Per Kilobase Million) 和 TPM (Transcripts Per Million)作为标准化数值。</p><p>RPKM 和 FPKM 的定义是相同的，唯一的区別是 FPKM 用于双端测序文库，而 RPKM 用于单端测序文库。</p><p>FPKM 和 TPM 都能够矫正掉<u>基因长度</u>及<u>测序深度</u>对 gene 表达定量的影响，区别在于</p><ul><li>FPKM 先计算比对到每个基因的 read 数占 reads 总数的比例，再考虑基因的长度；</li><li>而 TPM 是先考虑基因的长度，再把 read counts 转化为占处理之后的总数的比例。</li></ul><p>之所以要将 FPKM 转化为 TPM，是因为 TPM 可以使得每个样本的表达量<strong>总和都是1 Million</strong>，使得 TPM 中的基因表达量可以直接进行样本间的比较。</p><p>编写 FPKM2TPM.R 脚本，改进自 <code>/home/public/software/wfz_scripts/FPKM2TPM.R</code>​，主要改进点是把输出文件的 xls 格式改成了 tsv 文件格式。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/home/u22211520038/.conda/envs/achuan/bin/Rscript</span></span><br><span class="line"><span class="comment"># ====================================================================</span></span><br><span class="line">suppressPackageStartupMessages<span class="punctuation">(</span>library<span class="punctuation">(</span><span class="string">&quot;optparse&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># ====================================================================</span></span><br><span class="line">option_list <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-f&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--files&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    type <span class="operator">=</span> <span class="string">&quot;character&quot;</span><span class="punctuation">,</span> default <span class="operator">=</span> <span class="string">&quot;genes.fpkm_tracking&quot;</span><span class="punctuation">,</span></span><br><span class="line">    help <span class="operator">=</span> <span class="string">&quot;To specify fpkm files generated by cufflinks with comma-separate [default %default]&quot;</span></span><br><span class="line">  <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-l&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--labels&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    type <span class="operator">=</span> <span class="string">&quot;character&quot;</span><span class="punctuation">,</span> default <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    help <span class="operator">=</span> <span class="string">&quot;To specify labels [default %default]&quot;</span></span><br><span class="line">  <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-o&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--output&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    type <span class="operator">=</span> <span class="string">&quot;character&quot;</span><span class="punctuation">,</span> default <span class="operator">=</span> <span class="string">&quot;Expression&quot;</span><span class="punctuation">,</span></span><br><span class="line">    help <span class="operator">=</span> <span class="string">&quot;To specify output file [default %default]&quot;</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">parser <span class="operator">&lt;-</span> OptionParser<span class="punctuation">(</span></span><br><span class="line">  usage <span class="operator">=</span> <span class="string">&quot;%prog [options]&quot;</span><span class="punctuation">,</span> option_list <span class="operator">=</span> option_list<span class="punctuation">,</span></span><br><span class="line">  description <span class="operator">=</span> <span class="string">&quot;\nThe script is to convert FPKMs into TPMs.&quot;</span><span class="punctuation">,</span></span><br><span class="line">  epilogue <span class="operator">=</span> <span class="string">&quot;Feizhen Wu(wufz@fudan.edu.cn), July 09, 2018.\n&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">arguments <span class="operator">&lt;-</span> parse_args<span class="punctuation">(</span>parser<span class="punctuation">,</span> positional_arguments <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> print_help_and_exit <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">opt <span class="operator">&lt;-</span> arguments<span class="operator">$</span>options</span><br><span class="line">files <span class="operator">&lt;-</span> strsplit<span class="punctuation">(</span>opt<span class="operator">$</span>files<span class="punctuation">,</span> <span class="string">&quot;,&quot;</span><span class="punctuation">)</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">labels <span class="operator">&lt;-</span> strsplit<span class="punctuation">(</span>opt<span class="operator">$</span>labels<span class="punctuation">,</span> <span class="string">&quot;,&quot;</span><span class="punctuation">)</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">output <span class="operator">&lt;-</span> opt<span class="operator">$</span>output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>data.table<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>pheatmap<span class="punctuation">)</span></span><br><span class="line">FPKM2TPM <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>myfile<span class="punctuation">,</span> myName <span class="operator">=</span> myfile<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>myName <span class="operator">==</span> myfile<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    myName <span class="operator">&lt;-</span> sub<span class="punctuation">(</span>pattern <span class="operator">=</span> <span class="string">&quot;(.*)\\..*$&quot;</span><span class="punctuation">,</span> replacement <span class="operator">=</span> <span class="string">&quot;\\1&quot;</span><span class="punctuation">,</span> basename<span class="punctuation">(</span>myfile<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  cat<span class="punctuation">(</span><span class="string">&quot;The label of&quot;</span><span class="punctuation">,</span> myfile<span class="punctuation">,</span> <span class="string">&quot; was assigned as &quot;</span><span class="punctuation">,</span> myName<span class="punctuation">,</span> <span class="string">&quot;!\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>file.access<span class="punctuation">(</span>myfile<span class="punctuation">)</span> <span class="operator">==</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    stop<span class="punctuation">(</span>sprintf<span class="punctuation">(</span><span class="string">&quot;Specified file ( %s ) does not exist&quot;</span><span class="punctuation">,</span> myfile<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  Exp <span class="operator">&lt;-</span> fread<span class="punctuation">(</span>myfile<span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;gene_id&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FPKM&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">  Exp <span class="operator">&lt;-</span> Exp<span class="punctuation">[</span><span class="operator">!</span>grep<span class="punctuation">(</span><span class="string">&quot;^Mir&quot;</span><span class="punctuation">,</span> Exp<span class="operator">$</span>gene_id<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  Exp <span class="operator">&lt;-</span> Exp<span class="punctuation">[</span><span class="operator">!</span>grep<span class="punctuation">(</span><span class="string">&quot;^MIR&quot;</span><span class="punctuation">,</span> Exp<span class="operator">$</span>gene_id<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  Exp <span class="operator">&lt;-</span> Exp<span class="punctuation">[</span><span class="operator">!</span>duplicated<span class="punctuation">(</span>Exp<span class="operator">$</span>gene_id<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  ss <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>Exp<span class="operator">$</span>FPKM<span class="punctuation">)</span></span><br><span class="line">  Exp<span class="operator">$</span>Tpm <span class="operator">&lt;-</span> Exp<span class="operator">$</span>FPKM <span class="operator">/</span> ss <span class="operator">*</span> <span class="number">10</span><span class="operator">^</span><span class="number">6</span></span><br><span class="line">  Tpm <span class="operator">&lt;-</span> Exp<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">  Fpkm <span class="operator">&lt;-</span> Exp<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">  <span class="built_in">names</span><span class="punctuation">(</span>Tpm<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;gene_id&quot;</span><span class="punctuation">,</span> myName<span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">names</span><span class="punctuation">(</span>Fpkm<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;gene_id&quot;</span><span class="punctuation">,</span> myName<span class="punctuation">)</span></span><br><span class="line">  Result <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">  Result<span class="operator">$</span>Tpm <span class="operator">&lt;-</span> Tpm</span><br><span class="line">  Result<span class="operator">$</span>Fpkm <span class="operator">&lt;-</span> Fpkm</span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>Result<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================================</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>labels<span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  Exp1 <span class="operator">&lt;-</span> FPKM2TPM<span class="punctuation">(</span>files<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> labels<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">  Exp1 <span class="operator">&lt;-</span> FPKM2TPM<span class="punctuation">(</span>files<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">Exp_Tpm <span class="operator">&lt;-</span> Exp1<span class="operator">$</span>Tpm</span><br><span class="line">Exp_Fpkm <span class="operator">&lt;-</span> Exp1<span class="operator">$</span>Fpkm</span><br><span class="line">i <span class="operator">&lt;-</span> 2</span><br><span class="line"><span class="keyword">while</span> <span class="punctuation">(</span>i <span class="operator">&lt;=</span> <span class="built_in">length</span><span class="punctuation">(</span>files<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>i <span class="operator">&lt;=</span> <span class="built_in">length</span><span class="punctuation">(</span>labels<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    Exp1 <span class="operator">&lt;-</span> FPKM2TPM<span class="punctuation">(</span>files<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> labels<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    Exp1 <span class="operator">&lt;-</span> FPKM2TPM<span class="punctuation">(</span>files<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  Exp_Fpkm <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>Exp_Fpkm<span class="punctuation">,</span> Exp1<span class="operator">$</span>Fpkm<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;gene_id&quot;</span><span class="punctuation">)</span></span><br><span class="line">  Exp_Tpm <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>Exp_Tpm<span class="punctuation">,</span> Exp1<span class="operator">$</span>Tpm<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;gene_id&quot;</span><span class="punctuation">)</span></span><br><span class="line">  i <span class="operator">&lt;-</span> i <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">fwrite<span class="punctuation">(</span>Exp_Tpm<span class="punctuation">,</span> file <span class="operator">=</span> paste<span class="punctuation">(</span>output<span class="punctuation">,</span> <span class="string">&quot;_TPM.tsv&quot;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">fwrite<span class="punctuation">(</span>Exp_Fpkm<span class="punctuation">,</span> file <span class="operator">=</span> paste<span class="punctuation">(</span>output<span class="punctuation">,</span> <span class="string">&quot;_FPKM&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.tsv&quot;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">Exp <span class="operator">&lt;-</span> Exp_Tpm<span class="punctuation">[</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">p <span class="operator">&lt;-</span> cor<span class="punctuation">(</span>Exp<span class="punctuation">)</span></span><br><span class="line">pdf<span class="punctuation">(</span>file <span class="operator">=</span> paste<span class="punctuation">(</span>output<span class="punctuation">,</span> <span class="string">&quot;_TPM_correlation.pdf&quot;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">360</span> <span class="operator">/</span> <span class="number">100</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">437</span> <span class="operator">/</span> <span class="number">100</span><span class="punctuation">,</span> onefile <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>p<span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>p<span class="punctuation">,</span> file <span class="operator">=</span> paste<span class="punctuation">(</span>output<span class="punctuation">,</span> <span class="string">&quot;_TPM_correlation.tsv&quot;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>接下来编写 shell 脚本以批量传入参数运行，将 cufflinks 计算得到的各样本 FPKM 转化为 TPM。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=/home/u22211520038/workplace/homework1</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$PROJECT</span>/02_result/fpkm</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$PROJECT</span>/02_result/FPKM2TPM</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span>/02_result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链接，并以分组命名</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$PROJECT</span>/group.csv | <span class="keyword">while</span> IFS=<span class="string">&quot;,&quot;</span> <span class="built_in">read</span> -r SRR group;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$PROJECT</span>/02_result/cufflinks/<span class="variable">$&#123;SRR&#125;</span>/genes.fpkm_tracking <span class="variable">$PROJECT</span>/02_result/fpkm/<span class="variable">$&#123;group&#125;</span>.fpkm</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得fkpm的列表</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span>/02_result/fpkm</span><br><span class="line">delim=<span class="string">&quot;&quot;</span></span><br><span class="line">fpkm_list=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> `<span class="built_in">ls</span> *.fpkm`; <span class="keyword">do</span></span><br><span class="line">  temp=<span class="string">&quot;<span class="variable">$&#123;delim&#125;</span><span class="variable">$&#123;item##*/&#125;</span>&quot;</span></span><br><span class="line">  fpkm_list=<span class="string">&quot;<span class="variable">$&#123;fpkm_list&#125;</span><span class="variable">$&#123;temp&#125;</span>&quot;</span></span><br><span class="line">  delim=<span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过Rscript进行FPKM转化TPM的转化</span></span><br><span class="line">~/scripts/FPKM2TPM.R  -f <span class="variable">$fpkm_list</span> -o <span class="variable">$PROJECT</span>/02_result/FPKM2TPM/Expression</span><br></pre></td></tr></table></figure><p>FPKM2TPM.R 还会调用 pheatmap 包根据各样本的 TPM 表达量来绘制热图</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220924223301-uunvmdm.png"></div></div>​<p>‍</p><h3 id="4-用-cuffdiff-计算基因差异表达"><a class="markdownIt-Anchor" href="#4-用-cuffdiff-计算基因差异表达"></a> 4、用 cuffdiff 计算基因差异表达</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuffdiff -h</span></span><br><span class="line">Usage:   cuffdiff [options] &lt;transcripts.gtf&gt; &lt;sample1_hits.sam&gt; &lt;sample2_hits.sam&gt; [... sampleN_hits.sam]</span><br><span class="line">   Supply replicate SAMs as comma separated lists for each condition: sample1_rep1.sam,sample1_rep2.sam,...sample1_repM.sam</span><br></pre></td></tr></table></figure><p>了解 cuffdiff 的输入参数，需要输入 transcripts.gtf 和 sample_hits.bam 文件(或 sam 格式的文件）。</p><p>使用 cuffdiff 时需要注意</p><ul><li>样本重复和多样本分别以逗号和空格分隔：当一个样本有多个 replicate 时，使用逗号隔开。对于多个 sample，用空格隔开，以计算 samples 间的基因表达的差异性。</li><li>log2(fold_change)的值是 log2(sample2/sample1)，在统计上下调关系时需要注意输入的 sample 顺序，一般是 WT sample 在前，实验组 sample 在后。</li></ul><p>这一步将使用 cuffdiff 根据 Tophat2 生成的各样本比对文件 accepted_hits.bam 以及小鼠的基因组注释文件寻找差异基因。</p><ol><li><p>先编写 cuffdiff 的作业脚本：<code>vim ~/scripts/cuffdiff.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH -J cuffdiff</span></span><br><span class="line"><span class="comment">#SBATCH -p dna</span></span><br><span class="line"><span class="comment">#SBATCH -N 1</span></span><br><span class="line"><span class="comment">#SBATCH --mem=8G</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=2</span></span><br><span class="line"><span class="comment">#SBATCH -o slurm.%j.%x.out   # STDOUT</span></span><br><span class="line"><span class="comment">#SBATCH -e slurm.%j.%x.err   # STDERR</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=END  # 发送哪一种email通知：BEGIN,END,FAIL,ALL</span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=jxsu22@m.fudan.edu.cn</span></span><br><span class="line"></span><br><span class="line">outdir=<span class="variable">$1</span></span><br><span class="line">gtf=<span class="variable">$2</span></span><br><span class="line">bam_dir=<span class="variable">$3</span></span><br><span class="line">label1=<span class="variable">$4</span></span><br><span class="line">label2=<span class="variable">$5</span></span><br><span class="line"></span><br><span class="line">sample1=$(<span class="built_in">ls</span> <span class="variable">$bam_dir</span>/*<span class="variable">$label1</span>* | xargs | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">sample2=$(<span class="built_in">ls</span> <span class="variable">$bam_dir</span>/*<span class="variable">$label2</span>* | xargs | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">cuffdiff -p 2 -o <span class="variable">$outdir</span> \</span><br><span class="line">    -L <span class="variable">$label1</span>,<span class="variable">$label2</span> \</span><br><span class="line">    <span class="variable">$gtf</span> \</span><br><span class="line">    <span class="variable">$sample1</span> \ <span class="comment"># Separate different samples with space</span></span><br><span class="line">    <span class="variable">$sample2</span></span><br></pre></td></tr></table></figure></li><li><p>然后运行 shell 脚本，提交该任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=/home/u22211520038/workplace/homework1</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$PROJECT</span>/02_result/bam</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$PROJECT</span>/02_result/cuffdiff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链接，并以分组命名</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$PROJECT</span>/group.csv | <span class="keyword">while</span> IFS=<span class="string">&quot;,&quot;</span> <span class="built_in">read</span> -r SRR group;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$PROJECT</span>/02_result/tophat2/<span class="variable">$&#123;SRR&#125;</span>/accepted_hits.bam <span class="variable">$PROJECT</span>/02_result/bam/<span class="variable">$&#123;group&#125;</span>.bam</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT</span>/02_result/cuffdiff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行cuffdiff，进行差异基因分析</span></span><br><span class="line">sbatch ~/scripts/cuffdiff.sh \</span><br><span class="line">    <span class="variable">$PROJECT</span>/02_result/cuffdiff \</span><br><span class="line">    <span class="variable">$PROJECT</span>/00_index/mm10_genes.gtf \</span><br><span class="line">    <span class="variable">$PROJECT</span>/02_result/bam \</span><br><span class="line">    WT \</span><br><span class="line">    NonoKO</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>查看运行结果</p><p><code>ll $&#123;Project&#125;/02_result/cuffdiff</code></p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20220928231232-lzbzun2.png" alt="ll ${Project}/02_result/cuffdiff"></div><div class="image-meta"><span class="image-caption center">ll ${Project}/02_result/cuffdiff</span></div></div>​<p>可以看到生成了很多文件，后面的差异基因分析将主要用到 gene_exp.dff。其中第三列是基因名，第五列和第六列是比较的两个样本名，第 10 列是 log2(foldchange)值，第 12 列是 pvalue。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/Snipaste_2022-10-26_08-41-47-20221026084153-s33gjur.png" alt="less -SN ${Project}/02_result/cuffdiff/gene_exp.diff"></div><div class="image-meta"><span class="image-caption center">less -SN ${Project}/02_result/cuffdiff/gene_exp.diff</span></div></div>​</li></ol><h2 id="三-r-语言代码"><a class="markdownIt-Anchor" href="#三-r-语言代码"></a> 三、R 语言代码</h2><p>准备需要的 R 包</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> install.packages<span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span><span class="string">&quot;pheatmap&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;pheatmap&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span><span class="string">&quot;clusterProfiler&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;clusterProfiler&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span><span class="string">&quot;org.Mm.eg.db&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;org.Mm.eg.db&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span><span class="string">&quot;cowplot&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;cowplot&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>设置工作目录</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;~/workplace/homework1/02_result&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>从 cuffdiff 生成的 gene_exp.diff，进行解析，提取 | log2(foadchange) |&gt;1.5，p_value&lt;0.05 的差异基因，保存为 <code>DiffGenes_FC1.5.txt</code>​</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEG <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;./cuffdiff/gene_exp.diff&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">DEG <span class="operator">&lt;-</span> DEG<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">DEG <span class="operator">&lt;-</span> DEG<span class="punctuation">[</span><span class="built_in">is.finite</span><span class="punctuation">(</span>DEG<span class="operator">$</span>log2.fold_change.<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">DEG <span class="operator">&lt;-</span> DEG<span class="punctuation">[</span><span class="built_in">abs</span><span class="punctuation">(</span>DEG<span class="operator">$</span>log2.fold_change.<span class="punctuation">)</span> <span class="operator">&gt;</span> log2<span class="punctuation">(</span><span class="number">1.5</span><span class="punctuation">)</span> <span class="operator">&amp;</span> DEG<span class="operator">$</span>p_value <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">,</span> <span class="punctuation">]</span> <span class="comment"># 提取log2(foadchange)&gt;1.5，p_value&lt;0.05的差异基因</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>DEG<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;genes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;foldchange&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pvalue&quot;</span><span class="punctuation">)</span></span><br><span class="line">DEG<span class="operator">$</span>regulation <span class="operator">&lt;-</span> <span class="string">&quot;up&quot;</span></span><br><span class="line">DEG<span class="operator">$</span>regulation<span class="punctuation">[</span>DEG<span class="operator">$</span>foldchange <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;down&quot;</span></span><br><span class="line">DEG <span class="operator">&lt;-</span> DEG<span class="punctuation">[</span>order<span class="punctuation">(</span><span class="built_in">abs</span><span class="punctuation">(</span>DEG<span class="operator">$</span>foldchange<span class="punctuation">)</span><span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span> <span class="comment"># 按照foldchange绝对值大小进行倒序排序</span></span><br><span class="line">write.table<span class="punctuation">(</span>DEG<span class="punctuation">,</span> file <span class="operator">=</span> <span class="string">&quot;plot/DiffGenes_FC1.5.txt &quot;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>绘制差异基因的图</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bar-plot</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">  tab <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>table<span class="punctuation">(</span>DEG<span class="operator">$</span>regulation<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  tab<span class="operator">$</span>Var1 <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>tab<span class="operator">$</span>Var1<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;up&quot;</span><span class="punctuation">,</span> <span class="string">&quot;down&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>tab<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> Var1<span class="punctuation">,</span> y <span class="operator">=</span> Freq<span class="punctuation">,</span> label <span class="operator">=</span> Freq<span class="punctuation">,</span> fill <span class="operator">=</span> Var1<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;identity&quot;</span><span class="punctuation">)</span></span><br><span class="line">  p <span class="operator">&lt;-</span> p <span class="operator">+</span> geom_text<span class="punctuation">(</span>position <span class="operator">=</span> position_dodge<span class="punctuation">(</span><span class="number">0.9</span><span class="punctuation">)</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span> ylim<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>tab<span class="operator">$</span>Freq<span class="punctuation">)</span> <span class="operator">*</span> <span class="number">1.1</span><span class="punctuation">)</span></span><br><span class="line">  p <span class="operator">&lt;-</span> p <span class="operator">+</span> theme_classic<span class="punctuation">(</span><span class="number">8</span><span class="punctuation">)</span> <span class="operator">+</span> xlab<span class="punctuation">(</span><span class="string">&quot;differential expression&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span><span class="string">&quot;Number of genes&quot;</span><span class="punctuation">)</span></span><br><span class="line">  p <span class="operator">&lt;-</span> p <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;diffgenes&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br><span class="line">  p <span class="operator">&lt;-</span> p <span class="operator">+</span> theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  p</span><br><span class="line">  ggsave<span class="punctuation">(</span>p<span class="punctuation">,</span> filename <span class="operator">=</span> <span class="string">&quot;plot/diffgene_number_barplot.pdf&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2.2</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">2.2</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># heatmap</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  library<span class="punctuation">(</span>scales<span class="punctuation">)</span></span><br><span class="line">  library<span class="punctuation">(</span>pheatmap<span class="punctuation">)</span></span><br><span class="line">  dd <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;FPKM2TPM/Expression_TPM.tsv&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># 取Top50的差异基因在各个样本的TPM</span></span><br><span class="line">  DEG1 <span class="operator">&lt;-</span> DEG<span class="punctuation">[</span>order<span class="punctuation">(</span><span class="built_in">abs</span><span class="punctuation">(</span>DEG<span class="operator">$</span>foldchange<span class="punctuation">)</span><span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  num <span class="operator">&lt;-</span> 50</span><br><span class="line">  DEG1 <span class="operator">&lt;-</span> DEG1<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>num<span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  dd1 <span class="operator">&lt;-</span> dd<span class="punctuation">[</span>dd<span class="operator">$</span>gene_id <span class="operator">%in%</span> DEG1<span class="operator">$</span>genes<span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  row.names<span class="punctuation">(</span>dd1<span class="punctuation">)</span> <span class="operator">&lt;-</span> dd1<span class="operator">$</span>gene_id</span><br><span class="line">  dd1<span class="operator">$</span>gene_id <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">  <span class="built_in">names</span><span class="punctuation">(</span>dd1<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;set1_NonoKO_D0&quot;</span><span class="punctuation">,</span> <span class="string">&quot;set1_WT_D0&quot;</span><span class="punctuation">,</span> <span class="string">&quot;set2_NonoKO_D0&quot;</span><span class="punctuation">,</span> <span class="string">&quot;set2_WT_D0&quot;</span><span class="punctuation">)</span></span><br><span class="line">  dd2 <span class="operator">&lt;-</span> t<span class="punctuation">(</span>apply<span class="punctuation">(</span>dd1<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> rescale<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># 绘制热图</span></span><br><span class="line">  pdf<span class="punctuation">(</span>file <span class="operator">=</span> <span class="string">&quot;plot/top_50gene.pdf&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">7</span><span class="punctuation">)</span></span><br><span class="line">  pheatmap<span class="punctuation">(</span>dd2<span class="punctuation">,</span> cutree_rows <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> cutree_cols <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> fontsize_row <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line">  dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>GO 富集和 KEGG 富集分析代码</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>clusterProfiler<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>org.Mm.eg.db<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>cowplot<span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> bitr<span class="punctuation">(</span>DEG<span class="operator">$</span>genes<span class="punctuation">,</span></span><br><span class="line">  fromType <span class="operator">=</span> <span class="string">&quot;SYMBOL&quot;</span><span class="punctuation">,</span></span><br><span class="line">  toType <span class="operator">=</span> <span class="string">&quot;ENTREZID&quot;</span><span class="punctuation">,</span></span><br><span class="line">  OrgDb <span class="operator">=</span> org.Mm.eg.db</span><br><span class="line"><span class="punctuation">)</span> <span class="comment"># 选择小鼠数据库</span></span><br><span class="line"></span><br><span class="line">geneList <span class="operator">&lt;-</span> bitr<span class="punctuation">(</span>dd<span class="operator">$</span>gene_id<span class="punctuation">,</span></span><br><span class="line">  fromType <span class="operator">=</span> <span class="string">&quot;SYMBOL&quot;</span><span class="punctuation">,</span></span><br><span class="line">  toType <span class="operator">=</span> <span class="string">&quot;ENTREZID&quot;</span><span class="punctuation">,</span></span><br><span class="line">  OrgDb <span class="operator">=</span> org.Mm.eg.db</span><br><span class="line"><span class="punctuation">)</span> <span class="comment"># 选择小鼠数据库</span></span><br><span class="line"><span class="comment"># 对样本间的差异基因进行GO富集分析</span></span><br><span class="line">ego <span class="operator">&lt;-</span> enrichGO<span class="punctuation">(</span></span><br><span class="line">  gene <span class="operator">=</span> gene<span class="operator">$</span>ENTREZID<span class="punctuation">,</span></span><br><span class="line">  universe <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>geneList<span class="operator">$</span>ENTREZID<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  OrgDb <span class="operator">=</span> org.Mm.eg.db<span class="punctuation">,</span> <span class="comment"># 选择小鼠数据库</span></span><br><span class="line">  ont <span class="operator">=</span> <span class="string">&quot;BP&quot;</span><span class="punctuation">,</span></span><br><span class="line">  pAdjustMethod <span class="operator">=</span> <span class="string">&quot;BH&quot;</span><span class="punctuation">,</span></span><br><span class="line">  pvalueCutoff <span class="operator">=</span> <span class="number">0.01</span><span class="punctuation">,</span></span><br><span class="line">  qvalueCutoff <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span></span><br><span class="line">  readable <span class="operator">=</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 对样本间的差异基因进行KEGG富集分析</span></span><br><span class="line">kk <span class="operator">&lt;-</span> enrichKEGG<span class="punctuation">(</span></span><br><span class="line">  gene <span class="operator">=</span> gene<span class="operator">$</span>ENTREZID<span class="punctuation">,</span></span><br><span class="line">  organism <span class="operator">=</span> <span class="string">&quot;mmu&quot;</span><span class="punctuation">,</span> <span class="comment"># 选择小鼠</span></span><br><span class="line">  pvalueCutoff <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span></span><br><span class="line">  pAdjustMethod <span class="operator">=</span> <span class="string">&quot;BH&quot;</span><span class="punctuation">,</span></span><br><span class="line">  qvalueCutoff <span class="operator">=</span> <span class="number">0.05</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1 <span class="operator">&lt;-</span> dotplot<span class="punctuation">(</span>ego<span class="punctuation">,</span> showCategory <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> orderBy <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;dotplot for GOBP&quot;</span><span class="punctuation">)</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> dotplot<span class="punctuation">(</span>kk<span class="punctuation">,</span> showCategory <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> orderBy <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;dotplot for KEGG&quot;</span><span class="punctuation">)</span></span><br><span class="line">pp <span class="operator">&lt;-</span> plot_grid<span class="punctuation">(</span>p1<span class="punctuation">,</span> p2<span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span>p1<span class="punctuation">,</span> filename <span class="operator">=</span> <span class="string">&quot;plot/GO_enrichment.pdf&quot;</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span>p2<span class="punctuation">,</span> filename <span class="operator">=</span> <span class="string">&quot;plot/KEGG_enrichment.pdf&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h2 id="四-分析结果"><a class="markdownIt-Anchor" href="#四-分析结果"></a> 四、分析结果</h2><p>筛选差异基因，提取 | log2(foldchange) | &gt; 1.5，p_value&lt;0.05 的差异基因共 2599 个，上调基因共 947 个（log2(foldchange)&gt;=0），下调基因 1652 个（log2(foldchange)&lt;0）</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/Snipaste_2022-10-26_09-45-07-20221026094508-gu7vli7.png" alt="上下调基因数目比较"></div><div class="image-meta"><span class="image-caption center">上下调基因数目比较</span></div></div>​<p>按照 foldchange 的值由高到低进行排序，取 Top50 的差异基因，绘制热图。发现 set1_NonoKO_D0 和 set2_NonoKO_D0 的基因特征比较类似，而 set2_WT_D0 的上调基因含量过于高了，不确定是样本问题。NonoKO 细胞的 Mid1、Maf、Pcdh18 等众多基因下调，而 Hist1h2ah、Ftl1、Hprt 基因上调。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/Snipaste_2022-10-26_09-44-43-20221026094454-yjonve6.png" alt="Top50差异基因在各样本的表达量"></div><div class="image-meta"><span class="image-caption center">Top50差异基因在各样本的表达量</span></div></div>​<p>​</p><p>进行 GO 富集和 KEGG 富集分析</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/Snipaste_2022-10-25_23-45-22-20221025234524-qiue995.png" alt="GO的Biological process富集分析"></div><div class="image-meta"><span class="image-caption center">GO的Biological process富集分析</span></div></div>​<div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/Snipaste_2022-10-25_23-45-53-20221025234555-akrjhuo.png" alt="KEGG富集分析"></div><div class="image-meta"><span class="image-caption center">KEGG富集分析</span></div></div>​<p>通过 GO 的 Biological process 富集分析，发现这些差异基因主要在 epithelial tube morphogenesis、renal system development、mesenchyme development、kidney development、mesenchymal cell<br>differentiation 富集</p><p>通过 KEGG 富集分析，这些差异基因主要在 Proteoglycans in cancer、Focal adhesion、Axon guidance、ECM-receptor interaction、Basal cell carcinoma 等代谢途径富集</p><h2 id="五-存在的问题"><a class="markdownIt-Anchor" href="#五-存在的问题"></a> 五、存在的问题</h2><ul><li><p>trim_galore 过滤双端数据的时候，忘记加–paired 参数，发现 trim_galore 过滤双端数据生成的最终文件不是 trimed.fq.gz，而是 val_1.fq.gz 和 val_2.fq.gz.</p></li><li><p>一开始不明白 cuffdiff 的 gene_exp.diff 其中的 foldchange 是怎么计算的，四个样本输进去后会有 6 个组的比较，也就是说所有样本之间都进行比较了，包括 set1 的 WT 组和 set2 的 WT 组。后来经过助教的指导才发现自己没看仔细 cuffdiff 的使用规则，同一组的不同重复用逗号分割，不同组间应该用空格分割，说明无论做什么事情还是要仔细，不要一开始就犯错，理解有问题。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/6e57daa8/image-20221003224834-2o60cnv.png" alt="cuffdiff计算两组间的差异基因，却出现6组比较"></div><div class="image-meta"><span class="image-caption center">cuffdiff计算两组间的差异基因，却出现6组比较</span></div></div>​​</li><li><p>cuffdiff 的 log（foldchange）是 sample2/sample1，log（foldchange）&gt;0 代表 gene 在 sample2 中上调，log（foldchange）&lt;0 代表 gene 在 sample2 中下调。开始运行 cuffdiff 的时候，没有注意输入顺序，把 KO 放在了 WT 前面，造成上下调基因输出相反。</p></li><li><p>本次实验的样本量太少，set1 和 set2 同一组的 WT 小鼠的基因表达量差异也很大，GO 富集和 KEGG 富集分析的结果并不能说明什么，需要扩大样本量找到的差异基因才更有说服力。</p></li></ul><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 作业 </tag>
            
            <tag> 组学分析 </tag>
            
            <tag> 生信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PSSM矩阵计算</title>
      <link href="/posts/134ab329.html"/>
      <url>/posts/134ab329.html</url>
      
        <content type="html"><![CDATA[<p>PSSM（Position-Specific Scoring Matrix）是从MSA中构建的，实际上就是相同长度的一组序列根据各个位点氨基酸（碱基）频率计算得到的<strong>权值矩阵</strong>，是许多motif寻找软件的组成部分。</p><p>详细介绍见wiki：<a href="https://en.wikipedia.org/wiki/Position_weight_matrix">Position weight matrix - Wikipedia</a></p><p>PSSM就是一个打分矩阵，这个分数呢，可以是频数（PFM）、频率(PPM)、也可以是log-odds(PWM)。</p><h2 id="计算过程解释"><a class="markdownIt-Anchor" href="#计算过程解释"></a> 计算过程解释</h2><p>其典型计算过程为（以碱基为例）：</p><h3 id="1-计算pfmposition-frequency-matrix"><a class="markdownIt-Anchor" href="#1-计算pfmposition-frequency-matrix"></a> 1. 计算PFM(Position Frequency Matrix)</h3><p>从多序列比对MSA中，计算每个位点不同碱基的出现次数</p><p>GAGGTAAAC<br>TCCGTAAGT<br>CAGGTTGGA<br>ACAGTCAGT<br>TAGGTCATT<br>TAGGTACTG<br>ATGGTAACT<br>CAGGTATAC<br>TGTGTGAGT<br>AAGGTAAGT</p><p>得到PFM：</p><table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr></thead><tbody><tr><td>A</td><td>3</td><td>6</td><td>1</td><td>0</td><td>0</td><td>6</td><td>7</td><td>2</td><td>1</td></tr><tr><td>C</td><td>2</td><td>2</td><td>1</td><td>0</td><td>0</td><td>2</td><td>1</td><td>1</td><td>2</td></tr><tr><td>G</td><td>1</td><td>1</td><td>7</td><td>10</td><td>0</td><td>1</td><td>1</td><td>5</td><td>1</td></tr><tr><td>T</td><td>4</td><td>1</td><td>1</td><td>0</td><td>10</td><td>1</td><td>1</td><td>2</td><td>6</td></tr></tbody></table><h3 id="2-基于氨基酸频数计算ppmposition-probability-matrix"><a class="markdownIt-Anchor" href="#2-基于氨基酸频数计算ppmposition-probability-matrix"></a> 2. 基于氨基酸频数计算PPM（Position Probability Matrix）</h3><p>直接基于频数算频率</p><ul><li>Column 1: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mrow><mi>A</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo>=</mo><mfrac><mn>3</mn><mn>10</mn></mfrac><mo>=</mo><mn>0.3</mn><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>C</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub><mo>=</mo><mfrac><mn>2</mn><mn>10</mn></mfrac><mo>=</mo><mn>0.2</mn><mo separator="true">,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">f_{A, 1}=\frac{3}{10}=0.3, f_{C, 1}=\frac{2}{10}=0.2, \ldots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span></span></span></span></li><li>Column 2: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mrow><mi>A</mi><mo separator="true">,</mo><mn>2</mn></mrow></msub><mo>=</mo><mfrac><mn>6</mn><mn>10</mn></mfrac><mo>=</mo><mn>0.6</mn><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>C</mi><mo separator="true">,</mo><mn>2</mn></mrow></msub><mo>=</mo><mfrac><mn>2</mn><mn>10</mn></mfrac><mo>=</mo><mn>0.2</mn><mo separator="true">,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">f_{A, 2}=\frac{6}{10}=0.6, f_{C, 2}=\frac{2}{10}=0.2, \ldots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span></span></span></span></li><li>…</li></ul><table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr></thead><tbody><tr><td>A</td><td>0.3</td><td>0.6</td><td>0.1</td><td>0.0</td><td>0.0</td><td>0.6</td><td>0.7</td><td>0.2</td><td>0.1</td></tr><tr><td>C</td><td>0.2</td><td>0.2</td><td>0.1</td><td>0.0</td><td>0.0</td><td>0.2</td><td>0.1</td><td>0.1</td><td>0.2</td></tr><tr><td>G</td><td>0.1</td><td>0.1</td><td>0.7</td><td>1.0</td><td>0.0</td><td>0.1</td><td>0.1</td><td>0.5</td><td>0.1</td></tr><tr><td>T</td><td>0.4</td><td>0.1</td><td>0.1</td><td>0.0</td><td>1.0</td><td>0.1</td><td>0.1</td><td>0.2</td><td>0.6</td></tr></tbody></table><p>为了解决有些氨基酸类型出现为0的情况，可以给分子、分母增加pseudo-counts：</p><ul><li>Column 1: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>f</mi><mrow><mi>A</mi><mo separator="true">,</mo><mn>1</mn></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mfrac><mrow><mn>3</mn><mo>+</mo><mn>1</mn></mrow><mrow><mn>10</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mn>0.29</mn><mo separator="true">,</mo><msubsup><mi>f</mi><mrow><mi>C</mi><mo separator="true">,</mo><mn>1</mn></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>1</mn></mrow><mrow><mn>10</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mn>0.21</mn><mo separator="true">,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">f_{A, 1}^{\prime}=\frac{3+1}{10+4}=0.29, f_{C, 1}^{\prime}=\frac{2+1}{10+4}=0.21, \ldots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.163331em;vertical-align:-0.411439em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.424669em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.411439em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.163331em;vertical-align:-0.411439em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">9</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.424669em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.411439em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span></span></span></span></li><li>Column 2: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>f</mi><mrow><mi>A</mi><mo separator="true">,</mo><mn>2</mn></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mfrac><mrow><mn>6</mn><mo>+</mo><mn>1</mn></mrow><mrow><mn>10</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mn>0.50</mn><mo separator="true">,</mo><msubsup><mi>f</mi><mrow><mi>C</mi><mo separator="true">,</mo><mn>2</mn></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>1</mn></mrow><mrow><mn>10</mn><mo>+</mo><mn>4</mn></mrow></mfrac><mo>=</mo><mn>0.21</mn><mo separator="true">,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">f_{A, 2}^{\prime}=\frac{6+1}{10+4}=0.50, f_{C, 2}^{\prime}=\frac{2+1}{10+4}=0.21, \ldots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.163331em;vertical-align:-0.411439em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.424669em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.411439em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.163331em;vertical-align:-0.411439em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.424669em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.411439em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mbin mtight">+</span><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span></span></span></span></li><li>…</li></ul><table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr></thead><tbody><tr><td>A</td><td>0.29</td><td>0.50</td><td>0.14</td><td>0.07</td><td>0.07</td><td>0.50</td><td>0.57</td><td>0.21</td><td>0.14</td></tr><tr><td>C</td><td>0.21</td><td>0.21</td><td>0.14</td><td>0.07</td><td>0.07</td><td>0.21</td><td>0.14</td><td>0.14</td><td>0.21</td></tr><tr><td>G</td><td>0.14</td><td>0.14</td><td>0.57</td><td>0.79</td><td>0.07</td><td>0.14</td><td>0.14</td><td>0.43</td><td>0.14</td></tr><tr><td>T</td><td>0.36</td><td>0.14</td><td>0.14</td><td>0.07</td><td>0.79</td><td>0.14</td><td>0.14</td><td>0.21</td><td>0.50</td></tr></tbody></table><h3 id="3-计算位点权值矩阵pwmposition-weight-matrix"><a class="markdownIt-Anchor" href="#3-计算位点权值矩阵pwmposition-weight-matrix"></a> 3. 计算位点权值矩阵PWM（Position Weight Matrix）</h3><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>log</mi><mo>⁡</mo><mfrac><msubsup><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><msub><mi>P</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">S_{i, j}=\log \frac{f_{i, j}^{\prime}}{P_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3726640000000003em;vertical-align:-0.8360000000000001em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.536664em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7847720000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>即前景概率除以背景概率（odds），再用log算权值（log-odds），计算的权值能体现出位点出现该碱基（氨基酸）的优势比。</p><blockquote><p><a href="https://mp.weixin.qq.com/s/YHXCog8aThN7l9kp7-cY6g">优势、优势比为什么需要log2转换？ (qq.com)</a></p></blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 为相应碱基（氨基酸）类型在随机序列中出现的期望频率</p><ul><li>为了图方便最简单的模型会假设各碱基（氨基酸）出现频率一致，对于氨基酸为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><mn>20</mn></mfrac><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">P_i=\frac{1}{20}=0.05</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">5</span></span></span></span> ，对于核苷酸为: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">P_i=\frac{1}{4}=0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">5</span></span></span></span></li><li>实际使用，可以把数据集里的所有序列（不仅仅是motif）的碱基（氨基酸）出现频率手动计算一遍。</li></ul><p>这里就简单假设各碱基（氨基酸）出现频率一致</p><p>使用单纯频率的PPM，则PWM为</p><table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr></thead><tbody><tr><td>A</td><td>0.26</td><td>1.26</td><td>-1.32</td><td>-inf</td><td>-inf</td><td>1.26</td><td>1.49</td><td>-0.32</td><td>-1.32</td></tr><tr><td>C</td><td>-0.32</td><td>-0.32</td><td>-1.32</td><td>-inf</td><td>-inf</td><td>-0.32</td><td>-1.32</td><td>-1.32</td><td>-0.32</td></tr><tr><td>G</td><td>-1.32</td><td>-1.32</td><td>1.49</td><td>2.0</td><td>-inf</td><td>-1.32</td><td>-1.32</td><td>1.00</td><td>-1.32</td></tr><tr><td>T</td><td>0.68</td><td>-1.32</td><td>-1.32</td><td>-inf</td><td>2.0</td><td>-1.32</td><td>-1.32</td><td>-0.32</td><td>1.26</td></tr></tbody></table><p>使用加上pesudo-count的PPM，则PWM为</p><table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr></thead><tbody><tr><td>A</td><td>0.19</td><td>1.00</td><td>-0.81</td><td>-1.81</td><td>-1.81</td><td>1.00</td><td>1.19</td><td>-0.22</td><td>-0.81</td></tr><tr><td>C</td><td>-0.22</td><td>-0.22</td><td>-0.81</td><td>-1.81</td><td>-1.81</td><td>-0.22</td><td>-0.81</td><td>-0.81</td><td>-0.22</td></tr><tr><td>G</td><td>-0.81</td><td>-0.81</td><td>1.19</td><td>1.65</td><td>-1.81</td><td>-0.81</td><td>-0.81</td><td>0.78</td><td>-0.81</td></tr><tr><td>T</td><td>0.51</td><td>-0.81</td><td>-0.81</td><td>-1.81</td><td>1.65</td><td>-0.81</td><td>-0.81</td><td>-0.22</td><td>1.00</td></tr></tbody></table><blockquote><p>以上为典型的PSSM计算步骤，但是在具体实践上，不同的软件可能会对细节进行修改，从而得到的PSSM并不一样，如PSI-BLAST会采用BLOSUM62处理pseudo-counts问题。</p><p>另外，PSSM不处理MSA中位点插入和删除的情况。</p></blockquote><h2 id="使用python实现"><a class="markdownIt-Anchor" href="#使用python实现"></a> 使用Python实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PSSM</span>():</span><br><span class="line">    ALPHABET = <span class="built_in">dict</span>(</span><br><span class="line">        DNA = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>],</span><br><span class="line">        RNA = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;U&#x27;</span>],</span><br><span class="line">        AA = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>]</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, file_path: <span class="built_in">str</span>, alphabet_type: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Initialize PSSM object.</span></span><br><span class="line"><span class="string">        file_path: path of aln file</span></span><br><span class="line"><span class="string">        alphabet_type: DNA, RNA, AA</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.file_path = file_path</span><br><span class="line">        self.alphabet_type = alphabet_type</span><br><span class="line">        self.characters = self.ALPHABET[alphabet_type]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">seqs</span>(<span class="params">self</span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        read fasta file and return seq list</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        fa_dict = &#123;&#125;</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.file_path, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                line = line.strip()</span><br><span class="line">                <span class="keyword">if</span> line.startswith(<span class="string">&#x27;&gt;&#x27;</span>):</span><br><span class="line">                    name = line[<span class="number">1</span>:]</span><br><span class="line">                    fa_dict[name] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    fa_dict[name] += line</span><br><span class="line">        <span class="keyword">return</span> [seq <span class="keyword">for</span> seq <span class="keyword">in</span> fa_dict.values()]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">seq_length</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return the width of pssm</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.seqs[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">PFM</span>(<span class="params">self</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return the PFM</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        pfm = np.zeros((<span class="built_in">len</span>(self.characters), self.seq_length), dtype=<span class="built_in">int</span>)</span><br><span class="line">        <span class="keyword">for</span> j, seq <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(*self.seqs)):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self.characters)):</span><br><span class="line">                pfm[i][j] = seq.count(self.characters[i])</span><br><span class="line">        pfm = pd.DataFrame(pfm, index=self.characters,</span><br><span class="line">                           columns=<span class="built_in">range</span>(<span class="number">1</span>, self.seq_length+<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> pfm</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">PPM</span>(<span class="params">self</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return the PPM </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ppm = (self.PFM+<span class="number">1</span>) / (<span class="built_in">len</span>(self.seqs)+<span class="built_in">len</span>(self.characters))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">round</span>(ppm, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">PWM</span>(<span class="params">self</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return the PWM</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        pwm = np.log2(self.PPM / <span class="built_in">len</span>(self.characters)**(-<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">round</span>(pwm, <span class="number">4</span>)</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">consensus</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return the consensus sequence</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        consensus = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(self.seq_length):</span><br><span class="line">            consensus += self.characters[np.argmax(self.PFM.iloc[:, j])]</span><br><span class="line">        <span class="keyword">return</span> consensus</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ic</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return the information content for each position</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ic = np.<span class="built_in">sum</span>(self.PWM * self.PPM, axis=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">round</span>(ic, <span class="number">4</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pssm = PSSM(<span class="string">&#x27;./input/demo.fa&#x27;</span>, <span class="string">&#x27;DNA&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(pssm.PFM)</span><br><span class="line">    <span class="built_in">print</span>(pssm.PPM)</span><br><span class="line">    <span class="built_in">print</span>(pssm.PWM)</span><br><span class="line">    <span class="built_in">print</span>(pssm.consensus)</span><br><span class="line">    <span class="built_in">print</span>(pssm.ic)</span><br><span class="line">    <span class="comment"># pssm.seqlogo #todo</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="画weblogo"><a class="markdownIt-Anchor" href="#画weblogo"></a> 画weblogo</h2><p><a href="https://weblogo.berkeley.edu/logo.cgi">WebLogo - Create Sequence Logos (berkeley.edu)</a></p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/134ab329/image-20221021014159-45ms6pl.png"></div></div>​<p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 作业 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用Python实现Needleman-Wunsch和Smith-Waterman算法</title>
      <link href="/posts/be13a22e.html"/>
      <url>/posts/be13a22e.html</url>
      
        <content type="html"><![CDATA[<h2 id="python实现"><a class="markdownIt-Anchor" href="#python实现"></a> Python实现</h2><p>阿巛同学第一次较好的封装</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="用Python实现Needleman-Wunsch和Smith-Waterman算法" href="https://github.com/Achuan-2/python_beginner/tree/main/seqAlignment" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">用Python实现Needleman-Wunsch和Smith-Waterman算法</span><span class="cap link fs12">https://github.com/Achuan-2/python_beginner/tree/main/seqAlignment</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/link/8f277b4ee0ecd.svg"></div></div></a></div><h2 id="简单介绍"><a class="markdownIt-Anchor" href="#简单介绍"></a> <strong>简单介绍</strong></h2><p>Needleman-Wunsch和Smith-Waterman算法都是Pairwise alignment算法，用于双序列比对。</p><ul><li>Needleman-Wunsch是全局序列比对算法，最终会得到2条序列在全局上最佳的匹配结果（e.g. 最多的match数量、最高的比对得分、最高的identity）</li><li>Smith-Waterman是局部序列比对算法，最终得到的是2条序列在局部的最佳匹配片段（注意：即挑选出得分最高的比对片段）</li></ul><h2 id="算法实现介绍"><a class="markdownIt-Anchor" href="#算法实现介绍"></a> <strong>算法实现介绍</strong></h2><p>两个算法都是用了动态规划算法，什么叫动态规划呢。先思考下，若我们想要得到两条序列间最佳比对结果的话，你会怎么解决，穷举法？但是此方法需要穷举的次数随着序列长度的增加而不断增大，而且要考虑两条序列在哪里插入空位，比对结果的长度范围为n(两条序列完全匹配上)-2n(两条序列均对到空位)。</p><p>比对序列的长度越长，需要穷举的次数越多，这对我们来说将会耗时很多，这是不太现实的。所以我们需要一种新的方法进行比对——动态规划。动态规划算法是一种求取最优解的方法，该方法通过将问题拆解为若干子问题，求取子问题的最优解，所有子问题的最优解合并即为全局最优解。</p><p>下面具体介绍下两种算法的细节。</p><p>这两个算法都是先建立一个打分矩阵，考虑每个cell从各个方向的来源得分，记录最大得分的来源，最后按照规则回溯，从而得到比对结果。</p><h3 id="来源方向"><a class="markdownIt-Anchor" href="#来源方向"></a> 来源方向</h3><p>来源方向有三个：横着来的horizontal，竖着来的vertical，对角线来的diagonal，其中horizontal，vertical对于gap，而diagonal对应mismatch和match（diagonal来源的比对可以是确实比对上，也可以是强行比对）。</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/be13a22e/image-20221009003402-kkvkd5z.png"></div></div>​<h3 id="打分矩阵"><a class="markdownIt-Anchor" href="#打分矩阵"></a> 打分矩阵</h3><p>对于全局比对的Needleman-Wunsch算法而言：就考虑来自三个方向的分数情况，记录最大得分的来源</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/be13a22e/image-20221009002749-ktsnpmn.png"></div></div>​<p>而对于局部比对的Smith-Waterman算法而言：还需要考虑得分&gt;=0，如果得分少于0，则不记录方向。<div class="tag-plugin image"><div class="image-bg"><img src="/posts/be13a22e/image-20221009002858-cv8m89t.png"></div></div></p><blockquote><p>Attention!</p><ul><li><p>对于diagonal方向的<strong>得分</strong>，有两种方式</p><ul><li>一种就是看两个碱基match不match，match就+x分，mismatch就-y分</li><li>一种是替代矩阵M，M[A][B]为得分，经典的替代矩阵AM250和BLOSUM62，其中PAM250是基于高同源序列构建，BLOSUM62基于远程同源序列构建，因此寻找远程同源序列一般用BLOSUM62。</li></ul></li><li><p>对于vertical和horizonal方向的**罚分，**也有流行的两种方式</p><ul><li><p>一种是线性罚分，出现一个gap，我就扣k分</p><ul><li>举例，设置gap_open=-2。连续出现三个gap的罚分就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>2</mn><mo>×</mo><mn>3</mn><mo>=</mo><mo>−</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">-2\times3=-6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">6</span></span></span></span></li></ul></li><li><p>另一种叫affine gap penalty，翻译叫仿射罚分，即在打开第一个gap的时候引入gap open罚分，而在该gap的基础上进行延续则采用gap extension罚分。之所以这样做，相比从生物学原理来说，应该更倾向于仅出现一段长gap而不是多个短gap。</p><ul><li>举例，设置gap_open=-2,gap_extension=-1。连续出现三个gap的罚分就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>3</mn><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mo>−</mo><mn>1</mn><mo>=</mo><mo>−</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">-2+(3-1)\times-1=-4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">4</span></span></span></span></li></ul></li></ul></li></ul></blockquote><h3 id="回溯"><a class="markdownIt-Anchor" href="#回溯"></a> 回溯</h3><p>Needleman-Wunsch就是头对头、尾对尾算法，所以会从最右下角进行回溯</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/be13a22e/nw-20221009003602-vve5x1q.png"></div></div>​<p>Smith-Waterman只考虑找出最大得分的比对结果，所以会找出最高分的位置，开始回溯，直到cell的分数为0结束</p><div class="tag-plugin image"><div class="image-bg"><img src="/posts/be13a22e/sw-20221009003709-0l706lr.png"></div></div><blockquote><p>Question： 回溯时，横着和竖着的方向代表存在gap，那怎么知道gap是在哪条序列上呢？</p><p>Answer：看方向，垂直箭头的那个序列，就在对应碱基前加一个gap。比如横着的箭头，说明左侧的seq存在gap，竖着的箭头，则是顶部的seq存在gap。</p></blockquote><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><table><thead><tr><th><br></th><th>Needleman-Wunsch<br></th><th>Smith-Waterman</th></tr></thead><tbody><tr><td>比对方式</td><td>全局比对</td><td>局部比对</td></tr><tr><td>初始化得分矩阵</td><td>第0行和第0列置GAP罚分</td><td>行列全部置0</td></tr><tr><td>得分方式</td><td>允许负分</td><td>负分置0</td></tr><tr><td>回溯方式</td><td>右下角-&gt;左上角</td><td>最高分开始-&gt;位点分数为0结束</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 作业 </tag>
            
            <tag> 生信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Github】cdn jsdelivr加速使用方法</title>
      <link href="/posts/8b29a079.html"/>
      <url>/posts/8b29a079.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>前排</p><ul><li>2022 年 4 月 28 日遭到 DNS 污染，自此大陆无法正常访问 jsDelivr，导致大批网站工作失常。jsDelivr 进出大陆的始末详见 <a href="https://luotianyi.vc/6295.html">【杂谈】jsDelivr域名遭到DNS污染</a>。</li><li>2023 年 9 月 25日发现已可以使用，但是不再推荐使用jsdelivr用来加速图床，如果图床选用GitHub，建议不要cdn加速，图片链接直接用原本链接，起码能保证图片不失效。</li></ul></blockquote><h2 id="基本使用方法"><a class="markdownIt-Anchor" href="#基本使用方法"></a> 基本使用方法</h2><p>​<code>https://cdn.jsdelivr.net/gh/你的用户名/你的仓库名@branch/文件路径</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 加载任何Github发布、提交或分支</span><br><span class="line">https://cdn.jsdelivr.net/gh/user/repo@version/file</span><br><span class="line"></span><br><span class="line">// 加载 jQuery v3.2.1</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js</span><br><span class="line"></span><br><span class="line">// 指定仓库的分支</span><br><span class="line">https://cdn.jsdelivr.net/gh/Achuan-2/PicBed@pic</span><br><span class="line"></span><br><span class="line">// 使用版本范围而不是特定版本</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2/dist/jquery.min.js   https://cdn.jsdelivr.net/gh/jquery/jquery@3/dist/jquery.min.js</span><br><span class="line"> </span><br><span class="line">// 完全省略该版本以获取最新版本</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery/dist/jquery.min.js</span><br><span class="line"> </span><br><span class="line">// 将“.min”添加到任何JS/CSS文件中以获取缩小版本，如果不存在，将为会自动生成</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/src/core.min.js</span><br><span class="line"> </span><br><span class="line">// 在末尾添加 / 以获取资源目录列表</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery/</span><br></pre></td></tr></table></figure><h2 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意：</h2><ul><li><strong>jsDelivr 不支持加载超过 20M 的资源</strong></li><li>jsDelivr 只要加载过一次后，就会永久缓存，就算源码、原图片<strong>被删除，还是能加载</strong>！(好处是不怕丢，坏处是删不掉 😳）</li><li>版本号不是必需的，是为了区分新旧资源，如果不使用版本号，将会直接引用最新资源</li></ul><h2 id="补充"><a class="markdownIt-Anchor" href="#补充"></a> 补充：</h2><blockquote><p>‍</p><p>CDN 是一组分布在多个不同地方的 WEB 服务器，可以更加有效的向用户提供资源，会根据距离的远近来选择 。使用户能就近的获取请求数据，解决网络拥堵，提高访问速度，解决由于网络带宽小，用户访问量大，网点分布不均等原因导致的访问速度慢的问题。</p><p><strong>cdn 请求分发原理</strong></p><div class="tag-plugin image"><div class="image-bg"><img src="https://raw.githubusercontent.com/Achuan-2/PicBed/pic/assets/202309251517459.png"></div></div><p>（1）用户向浏览器提供需要访问的域名；</p><p>（2）浏览器调用域名解析库对域名进行解析，由于 CDN 对域名解析过程进行了调整，所以解析函数库一般得到的是该域名对应的 CNAME 记录，为了得到实际的 IP 地址，浏览器需要再次对获得的 CNAME 域名进行解析以得到实际的 IP 地址；在此过程中，使用的全局负载均衡 DNS 解析。如根据地理位置信息解析对应的 IP 地址，使得用户能就近访问；</p><p>（3）此次解析得到 CDN 缓存服务器的 IP 地址，浏览器在得到实际的 ip 地址之后，向缓存服务器发出访问请求；</p><p>（4）缓存服务器根据浏览器提供的要访问的域名，通过 Cache 内部专用 DNS 解析得到此域名的实际 IP 地址，再由缓存服务器向此实际 IP 地址提交访问请求；</p><p>（5）缓存服务器从实际 IP 地址得到内容以后，一方面<strong>在本地进行保存</strong>，以备以后使用，二方面把获取的数据放回给客户端，完成数据服务过程；</p><p>（6）客户端得到由缓存服务器返回的数据以后显示出来并完成整个浏览的数据请求过程。</p></blockquote><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 技术博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> 图床 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
